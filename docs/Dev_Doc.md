# CS2 Majorçº§åˆ«èµ›äº‹ç›´æ’­Overlayç³»ç»Ÿ - å®Œæ•´é¡¹ç›®æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [åŠŸèƒ½éœ€æ±‚](#åŠŸèƒ½éœ€æ±‚)
4. [å¼€å‘è®¡åˆ’](#å¼€å‘è®¡åˆ’)
5. [æŠ€æœ¯é€‰å‹](#æŠ€æœ¯é€‰å‹)
6. [ç³»ç»Ÿè®¾è®¡](#ç³»ç»Ÿè®¾è®¡)
7. [å®ç°ç»†èŠ‚](#å®ç°ç»†èŠ‚)
8. [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
9. [ä½¿ç”¨æ‰‹å†Œ](#ä½¿ç”¨æ‰‹å†Œ)
10. [é™„å½•](#é™„å½•)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç›®æ ‡
å¼€å‘ä¸€å¥—å®Œæ•´çš„CS2èµ›äº‹ç›´æ’­Overlayç³»ç»Ÿï¼Œæ”¯æŒæ¯”åˆ†æ˜¾ç¤ºã€BPæµç¨‹ã€é€‰æ‰‹ä¿¡æ¯ç­‰æ‰€æœ‰èµ›äº‹æ‰€éœ€çš„å›¾å½¢å åŠ å±‚ï¼Œå¹¶æä¾›å®Œæ•´çš„åå°æ§åˆ¶é¢æ¿ã€‚

### æ ¸å¿ƒç‰¹æ€§
- âœ… å®æ—¶æ¯”åˆ†æ›´æ–°
- âœ… BPï¼ˆBan/Pickï¼‰ç³»ç»Ÿ
- âœ… å¤šç§Overlayåœºæ™¯
- âœ… å¯è§†åŒ–æ§åˆ¶é¢æ¿
- âœ… OBSæµè§ˆå™¨æºé›†æˆ
- âœ… åŠ¨ç”»æ•ˆæœæ”¯æŒ
- âœ… ä¸»é¢˜è‡ªå®šä¹‰

### ç›®æ ‡ç”¨æˆ·
- èµ›äº‹ä¸»åŠæ–¹
- ç›´æ’­å¯¼æ’­
- èµ›äº‹æ•°æ®å‘˜
- å†…å®¹åˆ›ä½œè€…

---

## æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           OBS Studio                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Browser Src  â”‚  â”‚ Browser Src  â”‚  â”‚ Browser Src  â”‚             â”‚
â”‚  â”‚  Scoreboard  â”‚  â”‚     BP       â”‚  â”‚ Lower-third  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ WebSocket
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend Web    â”‚              â”‚   Electron Desktop App           â”‚
â”‚  (Overlay Pages)  â”‚              â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                   â”‚              â”‚   â”‚   Admin Dashboard        â”‚  â”‚
â”‚  - React/Next.js  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚   - Match Control        â”‚  â”‚
â”‚  - TypeScript     â”‚   Commands   â”‚   â”‚   - BP Control           â”‚  â”‚
â”‚  - Framer Motion  â”‚              â”‚   â”‚   - GSI Monitor          â”‚  â”‚
â”‚                   â”‚              â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ Socket.io
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Backend Server    â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                     â”‚         â”‚   CS2 Game       â”‚
              â”‚  - Node.js/Express  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤   GSI Server     â”‚
              â”‚  - Socket.io        â”‚  HTTP   â”‚   (localhost)    â”‚
              â”‚  - GSI Integration  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚  - REST API         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     Database        â”‚
              â”‚  PostgreSQL/MongoDB â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

              Monorepo Structure:
              â”œâ”€ packages/
              â”‚  â”œâ”€ web/          (Next.js Overlays)
              â”‚  â”œâ”€ desktop/      (Electron App)
              â”‚  â”œâ”€ server/       (Backend + GSI)
              â”‚  â””â”€ shared/       (å…±äº«ç±»å‹å’Œå·¥å…·)
```

### æŠ€æœ¯æ ˆ

#### å‰ç«¯
- **æ¡†æ¶**: Next.js 14 + TypeScript
- **çŠ¶æ€ç®¡ç†**: Zustand
- **åŠ¨ç”»**: Framer Motion
- **æ ·å¼**: Tailwind CSS
- **WebSocket**: Socket.io-client
- **å›¾è¡¨**: Recharts (å¯é€‰)

#### åç«¯
- **è¿è¡Œæ—¶**: Node.js 18+
- **æ¡†æ¶**: Express
- **WebSocket**: Socket.io
- **GSI**: è‡ªå®šä¹‰HTTPæœåŠ¡å™¨
- **éªŒè¯**: Zod
- **ORM**: Prisma (å¯é€‰)

#### æ¡Œé¢åº”ç”¨
- **æ¡†æ¶**: Electron
- **æ„å»ºå·¥å…·**: Vite
- **æ‰“åŒ…å·¥å…·**: electron-builder
- **UIæ¡†æ¶**: React + Tailwind CSS

#### Monorepo
- **åŒ…ç®¡ç†å™¨**: pnpm
- **æ„å»ºå·¥å…·**: Turborepo
- **ä»£ç å…±äº«**: TypeScript Project References

#### æ•°æ®åº“
- **ä¸»æ•°æ®åº“**: PostgreSQL æˆ– MongoDB
- **ç¼“å­˜**: Redis (å¯é€‰)

#### DevOps
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **è¿›ç¨‹ç®¡ç†**: PM2
- **åå‘ä»£ç†**: Nginx

---

## åŠŸèƒ½éœ€æ±‚

### 1. Overlayé¡µé¢æ¨¡å—

#### 1.1 æ¯”åˆ†æ¿ (Scoreboard)
**è·¯ç”±**: `/overlay/scoreboard`

**åŠŸèƒ½éœ€æ±‚**:
- æ˜¾ç¤ºåŒæ–¹é˜Ÿä¼åç§°å’ŒLogo
- å®æ—¶æ¯”åˆ†æ›´æ–°ï¼ˆå±€åˆ†ï¼‰
- å½“å‰åœ°å›¾åç§°
- å½“å‰å›åˆæ•°
- BO3/BO5ç³»åˆ—èµ›è¿›åº¦
- é˜Ÿä¼ç»æµæ˜¾ç¤ºï¼ˆå¯é€‰ï¼‰

**äº¤äº’éœ€æ±‚**:
- æ¯”åˆ†æ›´æ–°æ—¶æ’­æ”¾åŠ¨ç”»
- æ”¯æŒæ˜¾ç¤º/éšè—åˆ‡æ¢
- å…¥åœº/é€€åœºåŠ¨ç”»

**è®¾è®¡è¦æ±‚**:
- é€æ˜èƒŒæ™¯
- å°ºå¯¸: 1920x1080 é€‚é…
- åˆ·æ–°ç‡: 60fps

#### 1.2 BPç³»ç»Ÿ (Ban/Pick)
**è·¯ç”±**: `/overlay/bp`

**åŠŸèƒ½éœ€æ±‚**:
- åœ°å›¾æ± æ˜¾ç¤ºï¼ˆ7å¼ åœ°å›¾ï¼‰
- Bané˜¶æ®µå¯è§†åŒ–
- Pické˜¶æ®µå¯è§†åŒ–
- å½“å‰æ“ä½œé˜Ÿä¼é«˜äº®
- å€’è®¡æ—¶æ˜¾ç¤º
- Ban/Pické¡ºåºæŒ‡ç¤º

**æµç¨‹æ”¯æŒ**:
- BO1: Ban-Ban-Ban-Ban-Ban-Ban (å‰©ä½™1å›¾)
- BO3: Ban-Ban-Pick-Pick-Ban-Ban (å‰©ä½™1å›¾)
- BO5: Pick-Pick-Ban-Ban-Pick-Pick-Ban

**äº¤äº’éœ€æ±‚**:
- Ban/Pickæ“ä½œå®æ—¶æ˜¾ç¤º
- æ“ä½œç¡®è®¤åŠ¨ç”»
- æ”¯æŒæ’¤é”€æ“ä½œ

#### 1.3 é€‰æ‰‹ä¿¡æ¯æ¡ (Lower Third)
**è·¯ç”±**: `/overlay/lower-third`

**åŠŸèƒ½éœ€æ±‚**:
- é€‰æ‰‹æ¸¸æˆID
- çœŸå®å§“å
- å›½ç±/å¤´åƒ
- å½“å‰KDA
- å‡»æ€æ•°é«˜äº®

**äº¤äº’éœ€æ±‚**:
- æ»‘å…¥/æ»‘å‡ºåŠ¨ç”»
- æ”¯æŒå•äºº/äº”äººæ¨¡å¼
- è‡ªåŠ¨è½®æ’­ï¼ˆå¯é€‰ï¼‰

#### 1.4 é¡¶éƒ¨ä¿¡æ¯æ  (Top Bar)
**è·¯ç”±**: `/overlay/top-bar`

**åŠŸèƒ½éœ€æ±‚**:
- èµ›äº‹åç§°
- æ¯”èµ›é˜¶æ®µï¼ˆå°ç»„èµ›/æ·˜æ±°èµ›ï¼‰
- å½“å‰æ—¶é—´
- èµåŠ©å•†Logo

#### 1.5 åœ°å›¾ç¦é€‰ (Map Veto)
**è·¯ç”±**: `/overlay/map-veto`

**åŠŸèƒ½éœ€æ±‚**:
- å®Œæ•´vetoæµç¨‹å±•ç¤º
- å·²ban/pickåœ°å›¾çŠ¶æ€
- æœ€ç»ˆåœ°å›¾æ± ç»“æœ

#### 1.6 è¾…åŠ©Overlay
- **å€’è®¡æ—¶å™¨** `/overlay/countdown` - æš‚åœå€’è®¡æ—¶
- **å›æ”¾æ ‡è¯†** `/overlay/replay` - REPLAYå­—æ ·æ˜¾ç¤º
- **ä¸­åœºä¼‘æ¯** `/overlay/break` - ä¼‘æ¯ç”»é¢
- **èµåŠ©å•†** `/overlay/sponsor` - èµåŠ©å•†è½®æ’­
- **é€‰æ‰‹æ‘„åƒå¤´è¾¹æ¡†** `/overlay/player-cam` - æ‘„åƒå¤´è£…é¥°æ¡†

### 2. æ§åˆ¶é¢æ¿æ¨¡å—

#### 2.1 ä¸»æ§åˆ¶å° (Dashboard)
**è·¯ç”±**: `/admin/dashboard`

**åŠŸèƒ½éœ€æ±‚**:
- æ¯”èµ›æ€»è§ˆ
- å¿«é€Ÿæ“ä½œé¢æ¿
- å½“å‰overlayçŠ¶æ€
- WebSocketè¿æ¥çŠ¶æ€
- ç³»ç»Ÿæ—¥å¿—

#### 2.2 æ¯”èµ›æ§åˆ¶ (Match Control)
**è·¯ç”±**: `/admin/match-control`

**åŠŸèƒ½éœ€æ±‚**:
- é˜Ÿä¼ä¿¡æ¯ç¼–è¾‘
  - é˜Ÿåã€Logoã€ç®€ç§°
  - é€‰æ‰‹åå•
- æ¯”åˆ†æ§åˆ¶
  - +1/-1 æŒ‰é’®
  - ç›´æ¥è¾“å…¥
  - é‡ç½®åŠŸèƒ½
- åœ°å›¾é€‰æ‹©
- å›åˆæ•°æ§åˆ¶
- æ¯”èµ›é˜¶æ®µåˆ‡æ¢

**æ“ä½œè®°å½•**:
- æ‰€æœ‰æ“ä½œè®°å½•æ—¥å¿—
- æ”¯æŒæ’¤é”€/é‡åš

#### 2.3 BPæ§åˆ¶é¢æ¿ (BP Control)
**è·¯ç”±**: `/admin/bp-control`

**åŠŸèƒ½éœ€æ±‚**:
- åœ°å›¾æ± ç®¡ç†
- Banæ“ä½œ
- Pickæ“ä½œ
- å€’è®¡æ—¶æ§åˆ¶
- å½“å‰é˜Ÿä¼åˆ‡æ¢
- BPæµç¨‹é¢„è®¾åŠ è½½
- é‡ç½®BPæµç¨‹

**é¢„è®¾æ–¹æ¡ˆ**:
- BO1æµç¨‹
- BO3æµç¨‹
- BO5æµç¨‹
- è‡ªå®šä¹‰æµç¨‹

#### 2.4 åœºæ™¯åˆ‡æ¢å™¨ (Scene Switcher)
**è·¯ç”±**: `/admin/scenes`

**åŠŸèƒ½éœ€æ±‚**:
- é¢„è®¾åœºæ™¯ç®¡ç†
  - å¼€åœºåœºæ™¯
  - BPåœºæ™¯
  - æ¯”èµ›ä¸­åœºæ™¯
  - ä¸­åœºä¼‘æ¯åœºæ™¯
  - ç»“æŸåœºæ™¯
- ä¸€é”®åˆ‡æ¢overlayç»„åˆ
- åœºæ™¯ç¼–è¾‘å™¨

#### 2.5 Overlayå¼€å…³æ§åˆ¶
**è·¯ç”±**: `/admin/overlay-toggle`

**åŠŸèƒ½éœ€æ±‚**:
- æ‰€æœ‰overlayæ˜¾ç¤º/éšè—å¼€å…³
- é€æ˜åº¦æ§åˆ¶
- ä½ç½®å¾®è°ƒï¼ˆå¯é€‰ï¼‰

### 3. æ•°æ®ç®¡ç†æ¨¡å—

#### 3.1 é˜Ÿä¼ç®¡ç†
- CRUDæ“ä½œ
- Logoä¸Šä¼ 
- å†å²æ•°æ®

#### 3.2 é€‰æ‰‹ç®¡ç†
- é€‰æ‰‹ä¿¡æ¯
- ç»Ÿè®¡æ•°æ®
- å¤´åƒç®¡ç†

#### 3.3 èµ›äº‹ç®¡ç†
- èµ›äº‹åˆ›å»º
- èµ›ç¨‹å®‰æ’
- å¯¹é˜µé…ç½®

---

## å¼€å‘è®¡åˆ’

### é˜¶æ®µåˆ’åˆ†ï¼ˆ8å‘¨è®¡åˆ’ï¼‰

#### Week 1: åŸºç¡€æ­å»º (2025-02-03 ~ 02-09)

**Day 1-2: é¡¹ç›®åˆå§‹åŒ–**
- [ ] åˆ›å»ºGitä»“åº“
- [ ] å‰ç«¯é¡¹ç›®æ­å»º (Next.js)
- [ ] åç«¯é¡¹ç›®æ­å»º (Express)
- [ ] Dockerç¯å¢ƒé…ç½®
- [ ] æ•°æ®åº“è®¾è®¡

**äº¤ä»˜ç‰©**:
- é¡¹ç›®è„šæ‰‹æ¶
- å¼€å‘ç¯å¢ƒæ–‡æ¡£
- æ•°æ®åº“Schema

**Day 3-4: WebSocketåŸºç¡€**
- [ ] åç«¯Socket.ioæœåŠ¡
- [ ] å‰ç«¯Socketè¿æ¥
- [ ] äº‹ä»¶å®šä¹‰
- [ ] å¿ƒè·³æ£€æµ‹
- [ ] æ–­çº¿é‡è¿æœºåˆ¶

**äº¤ä»˜ç‰©**:
- WebSocketé€šä¿¡Demo
- äº‹ä»¶æ–‡æ¡£

**Day 5-7: æ•°æ®ç»“æ„è®¾è®¡**
- [ ] TypeScriptç±»å‹å®šä¹‰
- [ ] æ•°æ®æ¨¡å‹è®¾è®¡
- [ ] APIæ¥å£å®šä¹‰
- [ ] çŠ¶æ€ç®¡ç†æ¶æ„

**äº¤ä»˜ç‰©**:
- å®Œæ•´ç±»å‹å®šä¹‰æ–‡ä»¶
- APIæ–‡æ¡£v1.0

---

#### Week 2: æ ¸å¿ƒOverlay (2025-02-10 ~ 02-16)

**Day 8-10: æ¯”åˆ†æ¿å¼€å‘**
- [ ] UIç»„ä»¶å¼€å‘
- [ ] WebSocketé›†æˆ
- [ ] åŠ¨ç”»å®ç°
- [ ] OBSæµ‹è¯•

**äº¤ä»˜ç‰©**:
- å¯ç”¨çš„æ¯”åˆ†æ¿Overlay
- OBSé…ç½®æ–‡æ¡£

**Day 11-14: BPç³»ç»Ÿå¼€å‘**
- [ ] BP UIè®¾è®¡å®ç°
- [ ] Ban/Pické€»è¾‘
- [ ] å€’è®¡æ—¶åŠŸèƒ½
- [ ] æµç¨‹çŠ¶æ€æœº
- [ ] åŠ¨ç”»æ•ˆæœ

**äº¤ä»˜ç‰©**:
- å®Œæ•´BPç³»ç»Ÿ
- BPæµç¨‹æµ‹è¯•æŠ¥å‘Š

---

#### Week 3: æ§åˆ¶é¢æ¿ (2025-02-17 ~ 02-23)

**Day 15-17: ä¸»æ§åˆ¶å°**
- [ ] Dashboardå¸ƒå±€
- [ ] æ¯”åˆ†æ§åˆ¶ç»„ä»¶
- [ ] é˜Ÿä¼ç®¡ç†ç•Œé¢
- [ ] WebSocketå‘é€

**Day 18-19: BPæ§åˆ¶é¢æ¿**
- [ ] BPæ“ä½œç•Œé¢
- [ ] é¢„è®¾æ–¹æ¡ˆç®¡ç†
- [ ] æ’¤é”€/é‡åšåŠŸèƒ½

**Day 20-21: åœºæ™¯åˆ‡æ¢**
- [ ] åœºæ™¯ç®¡ç†å™¨
- [ ] é¢„è®¾åœºæ™¯é…ç½®
- [ ] ä¸€é”®åˆ‡æ¢åŠŸèƒ½

**äº¤ä»˜ç‰©**:
- å®Œæ•´æ§åˆ¶é¢æ¿
- æ“ä½œæ‰‹å†Œv1.0

---

#### Week 3.5: GSIé›†æˆ (2025-02-24 ~ 02-27)

**Day 22-23: CS2 GSIæœåŠ¡å™¨å¼€å‘**
- [ ] ç†è§£CS2 GSI (Game State Integration)
- [ ] é…ç½®CS2æ¸¸æˆGSI
- [ ] åç«¯GSI HTTPæœåŠ¡å™¨
- [ ] GSIæ•°æ®è§£æ
- [ ] å®æ—¶æ¯”åˆ†è‡ªåŠ¨åŒæ­¥

**GSIåŠŸèƒ½æ¸…å•**:
- å®æ—¶å›åˆæ•°æ®
- é˜Ÿä¼æ¯”åˆ†è‡ªåŠ¨æ›´æ–°
- é€‰æ‰‹KDAå®æ—¶ç»Ÿè®¡
- ç»æµæ•°æ®è¿½è¸ª
- ç‚¸å¼¹çŠ¶æ€ç›‘æ§
- MVPè¯†åˆ«

**Day 24-25: Monorepoæ¶æ„é‡æ„**
- [ ] é¡¹ç›®é‡æ„ä¸ºMonorepo
- [ ] ä½¿ç”¨pnpm workspace/Turborepo
- [ ] æŠ½å–å…±äº«ä»£ç åˆ°sharedåŒ…
- [ ] é…ç½®ç»Ÿä¸€çš„TypeScript
- [ ] ç»Ÿä¸€ESLint/Prettier

**Monorepoç»“æ„**:
```
cs2-overlay-system/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ web/              # Next.js Overlays
â”‚   â”œâ”€â”€ desktop/          # Electronæ§åˆ¶é¢æ¿
â”‚   â”œâ”€â”€ server/           # åç«¯ + GSI
â”‚   â””â”€â”€ shared/           # å…±äº«ç±»å‹å’Œå·¥å…·
â”œâ”€â”€ pnpm-workspace.yaml
â”œâ”€â”€ turbo.json
â””â”€â”€ package.json
```

**Day 26-27: Electronæ¡Œé¢åº”ç”¨å¼€å‘**
- [ ] Electroné¡¹ç›®åˆå§‹åŒ–
- [ ] é›†æˆæ§åˆ¶é¢æ¿åˆ°Electron
- [ ] çª—å£ç®¡ç†å’Œæ‰˜ç›˜å›¾æ ‡
- [ ] è‡ªåŠ¨å¯åŠ¨åŠŸèƒ½
- [ ] ç³»ç»Ÿé€šçŸ¥

**äº¤ä»˜ç‰©**:
- GSIé›†æˆå®Œæˆ
- Monorepoæ¶æ„
- Electron Alphaç‰ˆæœ¬

---

#### Week 4: æ‰©å±•åŠŸèƒ½ + Electronå®Œå–„ (2025-02-28 ~ 03-06)

#### Week 4: æ‰©å±•åŠŸèƒ½ + Electronå®Œå–„ (2025-02-28 ~ 03-06)

**Day 28-29: é€‰æ‰‹ä¿¡æ¯æ¡**
- [ ] Lower Thirdç»„ä»¶
- [ ] GSIæ•°æ®ç»‘å®š
- [ ] åŠ¨ç”»æ•ˆæœ

**Day 30-31: åœ°å›¾Veto**
- [ ] Map Veto UI
- [ ] æµç¨‹æ§åˆ¶
- [ ] ç»“æœå±•ç¤º

**Day 32-33: ElectronåŠŸèƒ½å®Œå–„**
- [ ] è‡ªåŠ¨æ›´æ–°åŠŸèƒ½
- [ ] é…ç½®æŒä¹…åŒ–
- [ ] å¿«æ·é”®æ”¯æŒ
- [ ] æ‰“åŒ…ä¼˜åŒ–

**Day 34: è¾…åŠ©Overlay**
- [ ] å€’è®¡æ—¶å™¨
- [ ] å›æ”¾æ ‡è¯†
- [ ] ä¸­åœºä¼‘æ¯ç”»é¢
- [ ] èµåŠ©å•†å±•ç¤º

**Day 35: é›†æˆæµ‹è¯•**
- [ ] æ‰€æœ‰overlayè”åŠ¨æµ‹è¯•
- [ ] GSIå®æ—¶æ•°æ®æµ‹è¯•
- [ ] Electronæ‰“åŒ…æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] å…¼å®¹æ€§æµ‹è¯•

**äº¤ä»˜ç‰©**:
- æ‰€æœ‰Overlayé¡µé¢
- Electron Betaç‰ˆæœ¬
- GSIå®Œæ•´é›†æˆ
- æµ‹è¯•æŠ¥å‘Š

---

#### Week 5: è§†è§‰ä¼˜åŒ– (2025-03-07 ~ 03-13)

**Day 29-31: UI/UXæ‰“ç£¨**
- [ ] è§†è§‰æ•ˆæœä¼˜åŒ–
- [ ] åŠ¨ç”»æµç•…åº¦è°ƒæ•´
- [ ] å­—ä½“å’Œæ’ç‰ˆ

**Day 32-33: ä¸»é¢˜ç³»ç»Ÿ**
- [ ] CSSå˜é‡ç³»ç»Ÿ
- [ ] ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
- [ ] é¢„è®¾ä¸»é¢˜ï¼ˆ3-5å¥—ï¼‰

**Day 34-35: æ€§èƒ½ä¼˜åŒ–**
- [ ] ç»„ä»¶æ‡’åŠ è½½
- [ ] å›¾ç‰‡ä¼˜åŒ–
- [ ] WebSocketèŠ‚æµ
- [ ] å†…å­˜æ³„æ¼æ£€æŸ¥

**äº¤ä»˜ç‰©**:
- ä¼˜åŒ–åçš„ç³»ç»Ÿ
- æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

---

#### Week 6: ç¨³å®šæ€§ (2025-03-14 ~ 03-20)

**Day 36-38: é”™è¯¯å¤„ç†**
- [ ] å¼‚å¸¸æ•è·æœºåˆ¶
- [ ] é™çº§æ–¹æ¡ˆ
- [ ] é”™è¯¯æ—¥å¿—ç³»ç»Ÿ
- [ ] æ•°æ®å¤‡ä»½æ¢å¤

**Day 39-40: éƒ¨ç½²å‡†å¤‡**
- [ ] ç”Ÿäº§ç¯å¢ƒé…ç½®
- [ ] Dockeré•œåƒæ„å»º
- [ ] CI/CDæµç¨‹
- [ ] ç›‘æ§å‘Šè­¦

**Day 41-42: æ–‡æ¡£ç¼–å†™**
- [ ] ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ
- [ ] éƒ¨ç½²è¿ç»´æ–‡æ¡£
- [ ] APIæ–‡æ¡£å®Œå–„
- [ ] æ•…éšœæ’æŸ¥æ‰‹å†Œ

**äº¤ä»˜ç‰©**:
- ç”Ÿäº§å°±ç»ªç‰ˆæœ¬
- å®Œæ•´æ–‡æ¡£é›†

---

#### Week 7-8: é«˜çº§åŠŸèƒ½ (2025-03-21 ~ 04-03)

**å¯é€‰åŠŸèƒ½å¼€å‘**:
- [ ] æ•°æ®ç»Ÿè®¡é¢æ¿
- [ ] å†å²æ•°æ®æŸ¥è¯¢
- [ ] è‡ªåŠ¨åŒ–é›†æˆ
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] éŸ³æ•ˆç³»ç»Ÿ
- [ ] ç§»åŠ¨ç«¯æ§åˆ¶ï¼ˆPWAï¼‰

**äº¤ä»˜ç‰©**:
- åŠŸèƒ½å®Œæ•´çš„ç³»ç»Ÿ
- v1.0æ­£å¼ç‰ˆæœ¬

---

### é‡Œç¨‹ç¢‘æ£€æŸ¥ç‚¹

#### Milestone 1: MVPå®Œæˆ (Week 2ç»“æŸ)
**éªŒæ”¶æ ‡å‡†**:
- âœ… æ¯”åˆ†æ¿å¯åœ¨OBSä¸­æ­£å¸¸æ˜¾ç¤º
- âœ… æ§åˆ¶é¢æ¿å¯æ›´æ–°æ¯”åˆ†
- âœ… WebSocketå®æ—¶åŒæ­¥æ­£å¸¸
- âœ… åŸºç¡€BPç³»ç»Ÿå¯ç”¨

**æ¼”ç¤ºè¦æ±‚**:
- æ¨¡æ‹Ÿä¸€åœºBO3æ¯”èµ›å®Œæ•´æµç¨‹

#### Milestone 2: åŠŸèƒ½å®Œæ•´ (Week 4ç»“æŸ)
**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰ä¸»è¦Overlayå®Œæˆ
- âœ… æ§åˆ¶é¢æ¿åŠŸèƒ½å®Œæ•´
- âœ… å¯è¿›è¡Œå®Œæ•´èµ›äº‹æ¼”ç»ƒ
- âœ… åŠ¨ç”»æ•ˆæœæµç•…

**æ¼”ç¤ºè¦æ±‚**:
- æ¨¡æ‹ŸçœŸå®èµ›äº‹2å°æ—¶ç›´æ’­

#### Milestone 3: ç”Ÿäº§å°±ç»ª (Week 6ç»“æŸ)
**éªŒæ”¶æ ‡å‡†**:
- âœ… ç³»ç»Ÿç¨³å®šè¿è¡Œ3å°æ—¶+
- âœ… æ€§èƒ½è¾¾æ ‡ï¼ˆ60fpsï¼‰
- âœ… æ–‡æ¡£é½å…¨
- âœ… éƒ¨ç½²æ–¹æ¡ˆå®Œæ•´

**äº¤ä»˜è¦æ±‚**:
- å¯ç‹¬ç«‹éƒ¨ç½²ä½¿ç”¨
- æä¾›åŸ¹è®­ææ–™

---

## æŠ€æœ¯é€‰å‹

### å‰ç«¯æŠ€æœ¯æ ˆè¯¦è§£

#### ä¸ºä»€ä¹ˆé€‰æ‹© Next.js?
1. **SSRæ”¯æŒ** - é¦–å±åŠ è½½ä¼˜åŒ–
2. **æ–‡ä»¶è·¯ç”±** - å¤©ç„¶æ”¯æŒå¤šé¡µé¢
3. **API Routes** - å¯å†…ç½®ç®€å•åç«¯
4. **ä¼˜ç§€ç”Ÿæ€** - ä¸°å¯Œçš„æ’ä»¶
5. **å¼€å‘ä½“éªŒ** - çƒ­é‡è½½ã€TypeScriptæ”¯æŒ

#### ä¸ºä»€ä¹ˆé€‰æ‹© Framer Motion?
1. **å£°æ˜å¼API** - ä»£ç ç®€æ´
2. **æ€§èƒ½ä¼˜ç§€** - GPUåŠ é€Ÿ
3. **æ‰‹åŠ¿æ”¯æŒ** - æ‹–æ‹½ç­‰äº¤äº’
4. **SpringåŠ¨ç”»** - è‡ªç„¶çš„ç‰©ç†åŠ¨ç”»
5. **Reacté›†æˆ** - æ— ç¼ä½¿ç”¨

#### ä¸ºä»€ä¹ˆé€‰æ‹© Zustand?
1. **è½»é‡çº§** - ä»…1kb
2. **ç®€å•æ˜“ç”¨** - æ— éœ€Provider
3. **TypeScriptå‹å¥½** - å®Œç¾ç±»å‹æ¨å¯¼
4. **DevTools** - è°ƒè¯•æ–¹ä¾¿
5. **æ€§èƒ½å¥½** - ç»†ç²’åº¦æ›´æ–°

### åç«¯æŠ€æœ¯æ ˆè¯¦è§£

#### ä¸ºä»€ä¹ˆé€‰æ‹© Express?
1. **æˆç†Ÿç¨³å®š** - ä¹…ç»è€ƒéªŒ
2. **ä¸­é—´ä»¶ä¸°å¯Œ** - ç”Ÿæ€å®Œå–„
3. **çµæ´»** - é«˜åº¦å¯å®šåˆ¶
4. **æ–‡æ¡£é½å…¨** - æ˜“å­¦ä¹ 
5. **ç¤¾åŒºæ´»è·ƒ** - é—®é¢˜è§£å†³å¿«

#### ä¸ºä»€ä¹ˆé€‰æ‹© Socket.io?
1. **è‡ªåŠ¨é™çº§** - å…¼å®¹æ€§å¥½
2. **æˆ¿é—´æœºåˆ¶** - æ˜“å®ç°åˆ†ç»„
3. **é‡è¿æœºåˆ¶** - ç¨³å®šæ€§é«˜
4. **äºŒè¿›åˆ¶æ”¯æŒ** - ä¼ è¾“æ•ˆç‡
5. **åŒå‘é€šä¿¡** - å®æ—¶æ€§å¼º

### æ•°æ®åº“é€‰æ‹©å»ºè®®

#### PostgreSQL (æ¨è)
**é€‚ç”¨åœºæ™¯**:
- éœ€è¦å¤æ‚æŸ¥è¯¢
- æ•°æ®å…³ç³»å¤æ‚
- ACIDè¦æ±‚é«˜

**ä¼˜åŠ¿**:
- åŠŸèƒ½å¼ºå¤§
- æ‰©å±•æ€§å¥½
- å¼€æºå…è´¹

#### MongoDB
**é€‚ç”¨åœºæ™¯**:
- æ•°æ®ç»“æ„çµæ´»
- å¿«é€Ÿè¿­ä»£
- æ¨ªå‘æ‰©å±•éœ€æ±‚

**ä¼˜åŠ¿**:
- Schemaçµæ´»
- æŸ¥è¯¢ç®€å•
- æ˜“äºä¸Šæ‰‹

---

## ç³»ç»Ÿè®¾è®¡

### æ•°æ®æ¨¡å‹è®¾è®¡

#### æ ¸å¿ƒå®ä½“

```typescript
// Match - æ¯”èµ›
interface Match {
  id: string;
  eventId: string;           // å…³è”èµ›äº‹
  teamA: Team;
  teamB: Team;
  format: 'BO1' | 'BO3' | 'BO5';
  currentMap: number;        // å½“å‰ç¬¬å‡ å¼ å›¾
  maps: Map[];
  status: 'upcoming' | 'live' | 'finished';
  startTime: Date;
  endTime?: Date;
  createdAt: Date;
  updatedAt: Date;
}

// Team - é˜Ÿä¼
interface Team {
  id: string;
  name: string;
  shortName: string;         // ç¼©å†™ï¼ˆ3-4å­—ç¬¦ï¼‰
  logo: string;              // Logo URL
  country: string;
  players: Player[];
  score: number;             // å½“å‰æ¯”åˆ†
  economy?: number;          // ç»æµ
  createdAt: Date;
  updatedAt: Date;
}

// Player - é€‰æ‰‹
interface Player {
  id: string;
  gameId: string;            // æ¸¸æˆID
  realName: string;
  country: string;
  avatar?: string;
  teamId: string;
  stats?: PlayerStats;
  createdAt: Date;
  updatedAt: Date;
}

// PlayerStats - é€‰æ‰‹ç»Ÿè®¡
interface PlayerStats {
  kills: number;
  deaths: number;
  assists: number;
  adr: number;              // å¹³å‡ä¼¤å®³
  rating: number;           // Rating 2.0
}

// Map - åœ°å›¾
interface Map {
  id: string;
  matchId: string;
  name: string;
  order: number;            // ç¬¬å‡ å¼ å›¾
  scoreA: number;
  scoreB: number;
  status: 'upcoming' | 'live' | 'finished';
  rounds: Round[];
  winner?: 'A' | 'B';
  createdAt: Date;
  updatedAt: Date;
}

// Round - å›åˆ
interface Round {
  id: string;
  mapId: string;
  roundNumber: number;
  winner: 'A' | 'B';
  reason: 'elimination' | 'bomb' | 'time' | 'defuse';
  mvp?: string;             // ç©å®¶ID
  createdAt: Date;
}

// BPSession - BPä¼šè¯
interface BPSession {
  id: string;
  matchId: string;
  mapPool: string[];        // åœ°å›¾æ± 
  actions: BPAction[];
  currentPhase: 'ban' | 'pick';
  activeTeam: 'A' | 'B';
  countdown: number;
  status: 'active' | 'completed';
  createdAt: Date;
  updatedAt: Date;
}

// BPAction - BPæ“ä½œ
interface BPAction {
  id: string;
  sessionId: string;
  type: 'ban' | 'pick';
  team: 'A' | 'B';
  map: string;
  order: number;
  timestamp: Date;
}

// OverlayState - OverlayçŠ¶æ€
interface OverlayState {
  scoreboard: {
    visible: boolean;
    opacity: number;
  };
  bp: {
    visible: boolean;
    opacity: number;
  };
  lowerThird: {
    visible: boolean;
    player?: Player;
  };
  // ... å…¶ä»–overlay
}

// Event - èµ›äº‹
interface Event {
  id: string;
  name: string;
  logo: string;
  startDate: Date;
  endDate: Date;
  format: string;
  sponsors: Sponsor[];
  createdAt: Date;
  updatedAt: Date;
}

// Sponsor - èµåŠ©å•†
interface Sponsor {
  id: string;
  name: string;
  logo: string;
  tier: 'title' | 'main' | 'partner';
  displayDuration: number;  // å±•ç¤ºæ—¶é•¿ï¼ˆç§’ï¼‰
}
```

### WebSocketäº‹ä»¶å®šä¹‰

#### å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯

```typescript
// è¿æ¥äº‹ä»¶
'client:connect' - å®¢æˆ·ç«¯è¿æ¥
'client:disconnect' - å®¢æˆ·ç«¯æ–­å¼€

// æ¯”èµ›æ§åˆ¶
'match:scoreUpdate' - æ›´æ–°æ¯”åˆ†
  payload: { team: 'A' | 'B', delta: number }

'match:roundUpdate' - æ›´æ–°å›åˆ
  payload: { mapId: string, winner: 'A' | 'B' }

'match:statusChange' - æ¯”èµ›çŠ¶æ€å˜æ›´
  payload: { status: MatchStatus }

// BPæ§åˆ¶
'bp:ban' - Banåœ°å›¾
  payload: { team: 'A' | 'B', map: string }

'bp:pick' - Pickåœ°å›¾
  payload: { team: 'A' | 'B', map: string }

'bp:undo' - æ’¤é”€æ“ä½œ
  payload: { actionId: string }

'bp:reset' - é‡ç½®BP
  payload: { sessionId: string }

// Overlayæ§åˆ¶
'overlay:toggle' - åˆ‡æ¢æ˜¾ç¤º
  payload: { name: string, visible: boolean }

'overlay:scene' - åˆ‡æ¢åœºæ™¯
  payload: { sceneId: string }
```

#### æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯

```typescript
// æ•°æ®æ¨é€
'match:update' - æ¯”èµ›æ•°æ®æ›´æ–°
  payload: Match

'bp:update' - BPçŠ¶æ€æ›´æ–°
  payload: BPSession

'overlay:update' - OverlayçŠ¶æ€æ›´æ–°
  payload: OverlayState

'player:statsUpdate' - é€‰æ‰‹æ•°æ®æ›´æ–°
  payload: PlayerStats[]

// ç³»ç»Ÿæ¶ˆæ¯
'system:error' - é”™è¯¯æ¶ˆæ¯
  payload: { code: string, message: string }

'system:notification' - é€šçŸ¥æ¶ˆæ¯
  payload: { type: 'info' | 'warning' | 'success', message: string }
```

### APIæ¥å£è®¾è®¡

#### RESTful API

```typescript
// æ¯”èµ›ç›¸å…³
GET    /api/matches              // è·å–æ¯”èµ›åˆ—è¡¨
GET    /api/matches/:id          // è·å–æ¯”èµ›è¯¦æƒ…
POST   /api/matches              // åˆ›å»ºæ¯”èµ›
PUT    /api/matches/:id          // æ›´æ–°æ¯”èµ›
DELETE /api/matches/:id          // åˆ é™¤æ¯”èµ›

// é˜Ÿä¼ç›¸å…³
GET    /api/teams                // è·å–é˜Ÿä¼åˆ—è¡¨
GET    /api/teams/:id            // è·å–é˜Ÿä¼è¯¦æƒ…
POST   /api/teams                // åˆ›å»ºé˜Ÿä¼
PUT    /api/teams/:id            // æ›´æ–°é˜Ÿä¼
DELETE /api/teams/:id            // åˆ é™¤é˜Ÿä¼

// é€‰æ‰‹ç›¸å…³
GET    /api/players              // è·å–é€‰æ‰‹åˆ—è¡¨
GET    /api/players/:id          // è·å–é€‰æ‰‹è¯¦æƒ…
POST   /api/players              // åˆ›å»ºé€‰æ‰‹
PUT    /api/players/:id          // æ›´æ–°é€‰æ‰‹
DELETE /api/players/:id          // åˆ é™¤é€‰æ‰‹

// BPç›¸å…³
GET    /api/bp/sessions/:matchId // è·å–BPä¼šè¯
POST   /api/bp/sessions          // åˆ›å»ºBPä¼šè¯
PUT    /api/bp/sessions/:id      // æ›´æ–°BPä¼šè¯

// Overlayç›¸å…³
GET    /api/overlay/state        // è·å–å½“å‰çŠ¶æ€
PUT    /api/overlay/state        // æ›´æ–°çŠ¶æ€

// ä¸Šä¼ 
POST   /api/upload/logo          // ä¸Šä¼ Logo
POST   /api/upload/avatar        // ä¸Šä¼ å¤´åƒ
```

### çŠ¶æ€ç®¡ç†æ¶æ„

#### Zustand Storeç»“æ„

```typescript
// stores/matchStore.ts
interface MatchStore {
  // çŠ¶æ€
  currentMatch: Match | null;
  matches: Match[];
  loading: boolean;
  error: string | null;
  
  // Actions
  setCurrentMatch: (match: Match) => void;
  updateScore: (team: 'A' | 'B', delta: number) => void;
  fetchMatches: () => Promise<void>;
  createMatch: (data: CreateMatchDTO) => Promise<void>;
}

// stores/bpStore.ts
interface BPStore {
  session: BPSession | null;
  history: BPAction[];
  
  ban: (team: 'A' | 'B', map: string) => void;
  pick: (team: 'A' | 'B', map: string) => void;
  undo: () => void;
  reset: () => void;
}

// stores/overlayStore.ts
interface OverlayStore {
  states: OverlayState;
  
  toggle: (name: string, visible: boolean) => void;
  setOpacity: (name: string, opacity: number) => void;
  switchScene: (sceneId: string) => void;
}

// stores/socketStore.ts
interface SocketStore {
  connected: boolean;
  socket: Socket | null;
  
  connect: () => void;
  disconnect: () => void;
  emit: (event: string, data: any) => void;
  on: (event: string, handler: Function) => void;
}
```

---

## GSIé›†æˆè¯¦è§£

### CS2 Game State Integrationç®€ä»‹

**GSI (Game State Integration)** æ˜¯CS2æä¾›çš„å®˜æ–¹APIï¼Œå…è®¸å¤–éƒ¨åº”ç”¨å®æ—¶è·å–æ¸¸æˆçŠ¶æ€æ•°æ®ã€‚è¿™å¯¹äºç›´æ’­å¯¼æ’­ç³»ç»Ÿè‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒå¯ä»¥ï¼š

- âœ… **è‡ªåŠ¨åŒ–æ•°æ®é‡‡é›†** - æ— éœ€æ‰‹åŠ¨è¾“å…¥æ¯”åˆ†
- âœ… **å®æ—¶æ€§** - æ¯«ç§’çº§å»¶è¿Ÿ
- âœ… **å‡†ç¡®æ€§** - ç›´æ¥æ¥è‡ªæ¸¸æˆå¼•æ“
- âœ… **ä¸°å¯Œæ•°æ®** - é€‰æ‰‹KDAã€ç»æµã€ç‚¸å¼¹çŠ¶æ€ç­‰

### GSIå·¥ä½œåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       HTTP POST        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CS2 Game  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚  GSI Server  â”‚
â”‚             â”‚   JSON Payload (1s)     â”‚  (Node.js)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ Parse & Emit
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚  WebSocket   â”‚
                                        â”‚   Clients    â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### GSIé…ç½®æ­¥éª¤

#### 1. åˆ›å»ºGSIé…ç½®æ–‡ä»¶

åœ¨CS2æ¸¸æˆç›®å½•åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š

**è·¯å¾„**: `steamapps/common/Counter-Strike Global Offensive/game/csgo/cfg/gamestate_integration_overlay.cfg`

```cfg
"CS2 Overlay Integration"
{
    "uri"               "http://localhost:3001/gsi"
    "timeout"           "5.0"
    "buffer"            "0.1"
    "throttle"          "0.5"
    "heartbeat"         "30.0"
    "auth"
    {
        "token"         "YOUR_SECRET_TOKEN_HERE"
    }
    "data"
    {
        "provider"            "1"
        "map"                 "1"
        "round"               "1"
        "player_id"           "1"
        "player_state"        "1"
        "player_weapons"      "1"
        "player_match_stats"  "1"
        "allplayers"          "1"
        "bomb"                "1"
        "phase_countdowns"    "1"
    }
}
```

#### 2. åç«¯GSIæœåŠ¡å™¨å®ç°

```typescript
// server/gsi/gsiServer.ts
import express from 'express';
import { Server as SocketIOServer } from 'socket.io';

interface GSIPayload {
  provider: {
    name: string;
    appid: number;
    version: number;
    steamid: string;
    timestamp: number;
  };
  map: {
    name: string;
    phase: 'warmup' | 'live' | 'intermission' | 'gameover';
    round: number;
    team_ct: {
      score: number;
      consecutive_round_losses: number;
    };
    team_t: {
      score: number;
      consecutive_round_losses: number;
    };
  };
  round: {
    phase: 'freezetime' | 'live' | 'over';
    bomb?: 'planted' | 'defused' | 'exploded';
    win_team?: 'CT' | 'T';
  };
  allplayers: {
    [steamid: string]: {
      name: string;
      observer_slot: number;
      team: 'T' | 'CT';
      match_stats: {
        kills: number;
        assists: number;
        deaths: number;
        mvps: number;
        score: number;
      };
      state: {
        health: number;
        armor: number;
        helmet: boolean;
        money: number;
        round_kills: number;
        round_killhs: number;
      };
    };
  };
  bomb?: {
    state: 'carried' | 'planted' | 'dropped' | 'defused' | 'exploded';
    position: string;
    countdown?: string;
  };
}

export class GSIServer {
  private app: express.Application;
  private io: SocketIOServer;
  private authToken: string;
  private currentState: GSIPayload | null = null;

  constructor(io: SocketIOServer, authToken: string) {
    this.app = express();
    this.io = io;
    this.authToken = authToken;
    this.setupRoutes();
  }

  private setupRoutes() {
    this.app.use(express.json());
    
    this.app.post('/gsi', (req, res) => {
      // éªŒè¯token
      if (req.body.auth?.token !== this.authToken) {
        return res.status(401).send('Unauthorized');
      }

      const payload: GSIPayload = req.body;
      this.handleGSIUpdate(payload);
      
      res.status(200).send('OK');
    });
  }

  private handleGSIUpdate(payload: GSIPayload) {
    this.currentState = payload;

    // æå–å…³é”®æ•°æ®
    const matchData = this.extractMatchData(payload);
    const playerStats = this.extractPlayerStats(payload);
    const roundInfo = this.extractRoundInfo(payload);

    // é€šè¿‡WebSocketå¹¿æ’­åˆ°æ‰€æœ‰å®¢æˆ·ç«¯
    this.io.to('overlay').emit('gsi:matchUpdate', matchData);
    this.io.to('overlay').emit('gsi:playerStats', playerStats);
    this.io.to('overlay').emit('gsi:roundUpdate', roundInfo);

    // è‡ªåŠ¨æ›´æ–°æ•°æ®åº“
    this.updateDatabase(matchData, playerStats);
  }

  private extractMatchData(payload: GSIPayload) {
    if (!payload.map) return null;

    return {
      mapName: payload.map.name,
      phase: payload.map.phase,
      round: payload.map.round,
      teamCT: {
        score: payload.map.team_ct.score,
        consecutiveLosses: payload.map.team_ct.consecutive_round_losses
      },
      teamT: {
        score: payload.map.team_t.score,
        consecutiveLosses: payload.map.team_t.consecutive_round_losses
      }
    };
  }

  private extractPlayerStats(payload: GSIPayload) {
    if (!payload.allplayers) return [];

    return Object.entries(payload.allplayers).map(([steamid, player]) => ({
      steamid,
      name: player.name,
      team: player.team,
      kills: player.match_stats.kills,
      assists: player.match_stats.assists,
      deaths: player.match_stats.deaths,
      mvps: player.match_stats.mvps,
      score: player.match_stats.score,
      health: player.state.health,
      armor: player.state.armor,
      money: player.state.money,
      roundKills: player.state.round_kills
    }));
  }

  private extractRoundInfo(payload: GSIPayload) {
    if (!payload.round) return null;

    return {
      phase: payload.round.phase,
      bombState: payload.bomb?.state,
      bombCountdown: payload.bomb?.countdown,
      winTeam: payload.round.win_team
    };
  }

  private async updateDatabase(matchData: any, playerStats: any[]) {
    // è‡ªåŠ¨æ›´æ–°æ¯”åˆ†åˆ°æ•°æ®åº“
    if (matchData) {
      await prisma.match.update({
        where: { id: currentMatchId },
        data: {
          // æ ¹æ®é˜Ÿä¼åç§°åŒ¹é…
          teamA: { score: matchData.teamCT.score },
          teamB: { score: matchData.teamT.score }
        }
      });
    }

    // æ›´æ–°é€‰æ‰‹ç»Ÿè®¡
    for (const player of playerStats) {
      await prisma.playerStats.upsert({
        where: { steamid_matchId: { steamid: player.steamid, matchId: currentMatchId } },
        update: {
          kills: player.kills,
          deaths: player.deaths,
          assists: player.assists
        },
        create: {
          steamid: player.steamid,
          matchId: currentMatchId,
          kills: player.kills,
          deaths: player.deaths,
          assists: player.assists
        }
      });
    }
  }

  listen(port: number) {
    this.app.listen(port, () => {
      console.log(`GSI Server listening on port ${port}`);
    });
  }
}
```

#### 3. å‰ç«¯GSIæ•°æ®é›†æˆ

```typescript
// components/overlays/LiveScoreboard.tsx
'use client';

import { useEffect, useState } from 'react';
import { motion } from 'framer-motion';
import { socketService } from '@/lib/socket';

export default function LiveScoreboard() {
  const [matchData, setMatchData] = useState(null);
  const [isLive, setIsLive] = useState(false);

  useEffect(() => {
    // ç›‘å¬GSIå®æ—¶æ•°æ®
    socketService.on('gsi:matchUpdate', (data) => {
      setMatchData(data);
      setIsLive(true);
    });

    // 5ç§’æ— æ•°æ®åˆ™è®¤ä¸ºæ–­å¼€
    const timeout = setTimeout(() => {
      setIsLive(false);
    }, 5000);

    return () => {
      clearTimeout(timeout);
      socketService.off('gsi:matchUpdate');
    };
  }, [matchData]);

  return (
    <div className="relative">
      {/* GSIè¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ */}
      <div className={`absolute top-2 right-2 w-3 h-3 rounded-full ${
        isLive ? 'bg-green-500 animate-pulse' : 'bg-red-500'
      }`} />
      
      {/* æ¯”åˆ†æ˜¾ç¤º */}
      {matchData && (
        <motion.div
          key={matchData.teamCT.score + matchData.teamT.score}
          animate={{ scale: [1, 1.05, 1] }}
        >
          <div>CT: {matchData.teamCT.score}</div>
          <div>T: {matchData.teamT.score}</div>
        </motion.div>
      )}
    </div>
  );
}
```

### GSIæ•°æ®åº”ç”¨åœºæ™¯

#### 1. è‡ªåŠ¨æ¯”åˆ†æ›´æ–°
```typescript
// æ¯”åˆ†è‡ªåŠ¨åŒæ­¥åˆ°Overlay
socketService.on('gsi:matchUpdate', (data) => {
  updateScoreboard(data.teamCT.score, data.teamT.score);
});
```

#### 2. å®æ—¶é€‰æ‰‹ç»Ÿè®¡
```typescript
// æ˜¾ç¤ºé€‰æ‰‹KDA
socketService.on('gsi:playerStats', (players) => {
  const topFragger = players.sort((a, b) => b.kills - a.kills)[0];
  showPlayerHighlight(topFragger);
});
```

#### 3. ç‚¸å¼¹çŠ¶æ€æç¤º
```typescript
// C4å·²å®‰è£…æç¤º
socketService.on('gsi:roundUpdate', (data) => {
  if (data.bombState === 'planted') {
    showBombPlantedOverlay(data.bombCountdown);
  }
});
```

#### 4. MVPè‡ªåŠ¨è¯†åˆ«
```typescript
// å›åˆç»“æŸæ˜¾ç¤ºMVP
socketService.on('gsi:roundUpdate', (data) => {
  if (data.phase === 'over' && data.mvp) {
    showMVPAnimation(data.mvp);
  }
});
```

---

## Electronæ¡Œé¢åº”ç”¨å¼€å‘

### ä¸ºä»€ä¹ˆä½¿ç”¨Electronï¼Ÿ

å¯¹äºå¯¼æ’­æ§åˆ¶é¢æ¿ï¼ŒElectronæä¾›äº†ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **ç‹¬ç«‹è¿è¡Œ** - ä¸ä¾èµ–æµè§ˆå™¨ï¼Œæ›´ä¸“ä¸š
2. **ç³»ç»Ÿé›†æˆ** - æ‰˜ç›˜å›¾æ ‡ã€å¿«æ·é”®ã€è‡ªåŠ¨å¯åŠ¨
3. **æ€§èƒ½ä¼˜åŒ–** - ç‹¬ç«‹è¿›ç¨‹ï¼Œä¸å—æµè§ˆå™¨é™åˆ¶
4. **åˆ†å‘ä¾¿æ·** - æ‰“åŒ…æˆexe/dmg/AppImage
5. **ç¦»çº¿å¯ç”¨** - æ— éœ€ç½‘ç»œå³å¯ä½¿ç”¨

### Monorepoé¡¹ç›®ç»“æ„

```
cs2-overlay-system/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ web/                    # Next.js Overlayé¡µé¢
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ desktop/                # Electronæ§åˆ¶é¢æ¿
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ main/          # Electronä¸»è¿›ç¨‹
â”‚   â”‚   â”‚   â”œâ”€â”€ renderer/      # Reactæ¸²æŸ“è¿›ç¨‹
â”‚   â”‚   â”‚   â””â”€â”€ preload/       # é¢„åŠ è½½è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ electron-builder.yml
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ server/                 # åç«¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ socket/
â”‚   â”‚   â”‚   â”œâ”€â”€ gsi/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ shared/                 # å…±äº«ä»£ç 
â”‚       â”œâ”€â”€ types/             # TypeScriptç±»å‹
â”‚       â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ constants/         # å¸¸é‡å®šä¹‰
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ pnpm-workspace.yaml
â”œâ”€â”€ turbo.json
â”œâ”€â”€ tsconfig.base.json
â””â”€â”€ package.json
```

### Monorepoé…ç½®

#### pnpm-workspace.yaml
```yaml
packages:
  - 'packages/*'
```

#### turbo.json
```json
{
  "$schema": "https://turbo.build/schema.json",
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": [".next/**", "dist/**", "out/**"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    },
    "lint": {
      "outputs": []
    }
  }
}
```

#### æ ¹package.json
```json
{
  "name": "cs2-overlay-system",
  "private": true,
  "scripts": {
    "dev": "turbo run dev --parallel",
    "build": "turbo run build",
    "dev:web": "pnpm --filter web dev",
    "dev:desktop": "pnpm --filter desktop dev",
    "dev:server": "pnpm --filter server dev",
    "build:desktop": "pnpm --filter desktop build"
  },
  "devDependencies": {
    "turbo": "^1.10.0",
    "typescript": "^5.2.0"
  }
}
```

### Electronä¸»è¿›ç¨‹å®ç°

```typescript
// packages/desktop/src/main/index.ts
import { app, BrowserWindow, Tray, Menu, globalShortcut } from 'electron';
import path from 'path';

class DesktopApp {
  private mainWindow: BrowserWindow | null = null;
  private tray: Tray | null = null;

  constructor() {
    this.init();
  }

  private async init() {
    await app.whenReady();
    this.createWindow();
    this.createTray();
    this.registerShortcuts();
    this.setupAutoLaunch();
  }

  private createWindow() {
    this.mainWindow = new BrowserWindow({
      width: 1400,
      height: 900,
      title: 'CS2 Overlay Control Panel',
      webPreferences: {
        nodeIntegration: false,
        contextIsolation: true,
        preload: path.join(__dirname, '../preload/index.js')
      },
      // è‡ªå®šä¹‰æ ‡é¢˜æ 
      frame: false,
      titleBarStyle: 'hidden'
    });

    // å¼€å‘ç¯å¢ƒ
    if (process.env.NODE_ENV === 'development') {
      this.mainWindow.loadURL('http://localhost:5173');
      this.mainWindow.webContents.openDevTools();
    } else {
      // ç”Ÿäº§ç¯å¢ƒ
      this.mainWindow.loadFile(path.join(__dirname, '../renderer/index.html'));
    }

    // çª—å£äº‹ä»¶
    this.mainWindow.on('close', (e) => {
      if (!app.isQuitting) {
        e.preventDefault();
        this.mainWindow?.hide();
      }
    });
  }

  private createTray() {
    this.tray = new Tray(path.join(__dirname, '../assets/icon.png'));
    
    const contextMenu = Menu.buildFromTemplate([
      { 
        label: 'Show Control Panel', 
        click: () => this.mainWindow?.show() 
      },
      { 
        label: 'Open Overlay (Browser)', 
        click: () => {
          require('electron').shell.openExternal('http://localhost:3000/overlay/scoreboard');
        }
      },
      { type: 'separator' },
      { 
        label: 'Start Server', 
        click: () => this.startBackendServer() 
      },
      { 
        label: 'Stop Server', 
        click: () => this.stopBackendServer() 
      },
      { type: 'separator' },
      { 
        label: 'Quit', 
        click: () => {
          app.isQuitting = true;
          app.quit();
        }
      }
    ]);

    this.tray.setContextMenu(contextMenu);
    this.tray.setToolTip('CS2 Overlay System');
    
    this.tray.on('double-click', () => {
      this.mainWindow?.show();
    });
  }

  private registerShortcuts() {
    // å…¨å±€å¿«æ·é”®
    globalShortcut.register('CommandOrControl+Shift+O', () => {
      this.mainWindow?.show();
    });

    // åœºæ™¯åˆ‡æ¢å¿«æ·é”®
    globalShortcut.register('F1', () => {
      this.toggleOverlay('scoreboard');
    });

    globalShortcut.register('F2', () => {
      this.toggleOverlay('bp');
    });
  }

  private toggleOverlay(name: string) {
    // é€šè¿‡IPCé€šçŸ¥æ¸²æŸ“è¿›ç¨‹
    this.mainWindow?.webContents.send('overlay:toggle', { name });
  }

  private setupAutoLaunch() {
    if (process.platform === 'win32') {
      app.setLoginItemSettings({
        openAtLogin: true,
        path: process.execPath
      });
    }
  }

  private startBackendServer() {
    // å¯åŠ¨å†…ç½®çš„åç«¯æœåŠ¡å™¨
    const { fork } = require('child_process');
    const serverPath = path.join(__dirname, '../../server/dist/index.js');
    fork(serverPath);
  }

  private stopBackendServer() {
    // åœæ­¢åç«¯æœåŠ¡å™¨
  }
}

new DesktopApp();
```

### Electronæ¸²æŸ“è¿›ç¨‹ï¼ˆReactï¼‰

```typescript
// packages/desktop/src/renderer/App.tsx
import { useState, useEffect } from 'react';
import { MatchControl } from './components/MatchControl';
import { BPControl } from './components/BPControl';
import { GSIMonitor } from './components/GSIMonitor';

export default function App() {
  const [activeTab, setActiveTab] = useState('match');
  const [gsiConnected, setGsiConnected] = useState(false);

  useEffect(() => {
    // ç›‘å¬GSIè¿æ¥çŠ¶æ€
    window.electron.on('gsi:status', (status) => {
      setGsiConnected(status.connected);
    });

    return () => {
      window.electron.removeAllListeners('gsi:status');
    };
  }, []);

  return (
    <div className="h-screen flex flex-col bg-gray-900 text-white">
      {/* è‡ªå®šä¹‰æ ‡é¢˜æ  */}
      <div className="h-8 bg-gray-800 drag flex items-center justify-between px-4">
        <div className="flex items-center gap-2">
          <div className={`w-2 h-2 rounded-full ${
            gsiConnected ? 'bg-green-500' : 'bg-red-500'
          }`} />
          <span className="text-sm">CS2 Overlay Control Panel</span>
        </div>
        <div className="no-drag flex gap-2">
          <button onClick={() => window.electron.minimize()}>âˆ’</button>
          <button onClick={() => window.electron.maximize()}>â–¡</button>
          <button onClick={() => window.electron.close()}>Ã—</button>
        </div>
      </div>

      {/* ä¸»å†…å®¹åŒº */}
      <div className="flex-1 flex">
        {/* ä¾§è¾¹æ  */}
        <aside className="w-64 bg-gray-800 p-4">
          <nav className="space-y-2">
            <button
              onClick={() => setActiveTab('match')}
              className={`w-full text-left px-4 py-2 rounded ${
                activeTab === 'match' ? 'bg-blue-600' : 'hover:bg-gray-700'
              }`}
            >
              Match Control
            </button>
            <button
              onClick={() => setActiveTab('bp')}
              className={`w-full text-left px-4 py-2 rounded ${
                activeTab === 'bp' ? 'bg-blue-600' : 'hover:bg-gray-700'
              }`}
            >
              BP Control
            </button>
            <button
              onClick={() => setActiveTab('gsi')}
              className={`w-full text-left px-4 py-2 rounded ${
                activeTab === 'gsi' ? 'bg-blue-600' : 'hover:bg-gray-700'
              }`}
            >
              GSI Monitor
            </button>
          </nav>
        </aside>

        {/* å†…å®¹åŒº */}
        <main className="flex-1 p-6 overflow-auto">
          {activeTab === 'match' && <MatchControl />}
          {activeTab === 'bp' && <BPControl />}
          {activeTab === 'gsi' && <GSIMonitor />}
        </main>
      </div>

      {/* çŠ¶æ€æ  */}
      <footer className="h-8 bg-gray-800 px-4 flex items-center justify-between text-xs">
        <div>Server: Running on :3001</div>
        <div>Overlays: 3 connected</div>
      </footer>
    </div>
  );
}
```

### Electron Preloadè„šæœ¬

```typescript
// packages/desktop/src/preload/index.ts
import { contextBridge, ipcRenderer } from 'electron';

// æš´éœ²å®‰å…¨çš„APIç»™æ¸²æŸ“è¿›ç¨‹
contextBridge.exposeInMainWorld('electron', {
  // çª—å£æ§åˆ¶
  minimize: () => ipcRenderer.send('window:minimize'),
  maximize: () => ipcRenderer.send('window:maximize'),
  close: () => ipcRenderer.send('window:close'),

  // äº‹ä»¶ç›‘å¬
  on: (channel: string, callback: Function) => {
    ipcRenderer.on(channel, (_, data) => callback(data));
  },
  
  removeAllListeners: (channel: string) => {
    ipcRenderer.removeAllListeners(channel);
  },

  // Overlayæ§åˆ¶
  toggleOverlay: (name: string, visible: boolean) => {
    ipcRenderer.send('overlay:toggle', { name, visible });
  },

  // æœåŠ¡å™¨æ§åˆ¶
  startServer: () => ipcRenderer.send('server:start'),
  stopServer: () => ipcRenderer.send('server:stop')
});
```

### Electronæ‰“åŒ…é…ç½®

```yaml
# packages/desktop/electron-builder.yml
appId: com.cs2overlay.desktop
productName: CS2 Overlay System
directories:
  output: dist-electron
  buildResources: build

files:
  - dist/**/*
  - node_modules/**/*
  - package.json

mac:
  category: public.app-category.utilities
  target:
    - dmg
    - zip
  icon: build/icon.icns

win:
  target:
    - nsis
    - portable
  icon: build/icon.ico

linux:
  target:
    - AppImage
    - deb
  icon: build/icon.png
  category: Utility

nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  createDesktopShortcut: true
  createStartMenuShortcut: true
```

### æ‰“åŒ…å‘½ä»¤

```json
// packages/desktop/package.json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build && electron-builder",
    "build:win": "npm run build -- --win",
    "build:mac": "npm run build -- --mac",
    "build:linux": "npm run build -- --linux"
  }
}
```

---

## å®ç°ç»†èŠ‚

### 1. WebSocketå®æ—¶é€šä¿¡

#### æœåŠ¡ç«¯å®ç°

```typescript
// server/socket.ts
import { Server } from 'socket.io';
import { Server as HttpServer } from 'http';

export function initializeSocket(httpServer: HttpServer) {
  const io = new Server(httpServer, {
    cors: {
      origin: process.env.CORS_ORIGIN || '*',
      credentials: true
    },
    pingTimeout: 60000,
    pingInterval: 25000
  });

  // è¿æ¥å¤„ç†
  io.on('connection', (socket) => {
    console.log('Client connected:', socket.id);
    
    // åŠ å…¥æˆ¿é—´
    socket.join('overlay');
    socket.join('admin');
    
    // æ¯”èµ›æ§åˆ¶
    socket.on('match:scoreUpdate', async (data) => {
      try {
        const match = await updateMatchScore(data);
        io.to('overlay').emit('match:update', match);
      } catch (error) {
        socket.emit('system:error', { 
          message: 'Failed to update score' 
        });
      }
    });
    
    // BPæ§åˆ¶
    socket.on('bp:ban', async (data) => {
      try {
        const session = await processBan(data);
        io.to('overlay').emit('bp:update', session);
      } catch (error) {
        socket.emit('system:error', { 
          message: 'Failed to ban map' 
        });
      }
    });
    
    // Overlayæ§åˆ¶
    socket.on('overlay:toggle', (data) => {
      io.to('overlay').emit('overlay:update', data);
    });
    
    // æ–­å¼€å¤„ç†
    socket.on('disconnect', () => {
      console.log('Client disconnected:', socket.id);
    });
  });

  return io;
}
```

#### å®¢æˆ·ç«¯å®ç°

```typescript
// lib/socket.ts
import { io, Socket } from 'socket.io-client';

class SocketService {
  private socket: Socket | null = null;
  private reconnectAttempts = 0;
  private maxReconnectAttempts = 5;

  connect(url: string) {
    this.socket = io(url, {
      reconnection: true,
      reconnectionDelay: 1000,
      reconnectionDelayMax: 5000,
      reconnectionAttempts: this.maxReconnectAttempts
    });

    this.socket.on('connect', () => {
      console.log('Connected to server');
      this.reconnectAttempts = 0;
    });

    this.socket.on('disconnect', () => {
      console.log('Disconnected from server');
    });

    this.socket.on('connect_error', (error) => {
      this.reconnectAttempts++;
      console.error('Connection error:', error);
      
      if (this.reconnectAttempts >= this.maxReconnectAttempts) {
        console.error('Max reconnection attempts reached');
        // è§¦å‘é™çº§æ–¹æ¡ˆ
        this.handleConnectionFailure();
      }
    });
  }

  emit(event: string, data: any) {
    this.socket?.emit(event, data);
  }

  on(event: string, handler: Function) {
    this.socket?.on(event, handler as any);
  }

  off(event: string, handler?: Function) {
    this.socket?.off(event, handler as any);
  }

  disconnect() {
    this.socket?.disconnect();
  }

  private handleConnectionFailure() {
    // å¯ç”¨æœ¬åœ°ç¼“å­˜
    // æ˜¾ç¤ºç¦»çº¿æç¤º
    // å°è¯•ä½¿ç”¨å¤‡ç”¨æœåŠ¡å™¨
  }
}

export const socketService = new SocketService();
```

### 2. Overlayç»„ä»¶å®ç°

#### æ¯”åˆ†æ¿ç»„ä»¶

```typescript
// components/overlays/Scoreboard.tsx
'use client';

import { useEffect, useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { socketService } from '@/lib/socket';
import { Match } from '@/types';

export default function Scoreboard() {
  const [match, setMatch] = useState<Match | null>(null);
  const [visible, setVisible] = useState(true);

  useEffect(() => {
    // è¿æ¥Socket
    socketService.connect(process.env.NEXT_PUBLIC_SOCKET_URL!);

    // ç›‘å¬æ¯”èµ›æ›´æ–°
    socketService.on('match:update', (data: Match) => {
      setMatch(data);
    });

    // ç›‘å¬æ˜¾ç¤ºæ§åˆ¶
    socketService.on('overlay:update', (data: any) => {
      if (data.name === 'scoreboard') {
        setVisible(data.visible);
      }
    });

    return () => {
      socketService.off('match:update');
      socketService.off('overlay:update');
    };
  }, []);

  if (!match) return null;

  return (
    <AnimatePresence>
      {visible && (
        <motion.div
          className="fixed top-0 left-1/2 -translate-x-1/2 mt-8"
          initial={{ y: -100, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          exit={{ y: -100, opacity: 0 }}
          transition={{ type: 'spring', damping: 20 }}
        >
          <div className="bg-gradient-to-r from-gray-900/90 to-gray-800/90 backdrop-blur-md rounded-lg px-8 py-4 shadow-2xl border border-gray-700/50">
            <div className="flex items-center gap-8">
              {/* é˜Ÿä¼A */}
              <TeamSection 
                team={match.teamA} 
                score={match.teamA.score}
                side="left"
              />
              
              {/* ä¸­é—´ä¿¡æ¯ */}
              <div className="text-center min-w-[120px]">
                <div className="text-sm text-gray-400 mb-1">
                  {match.currentMap}/{match.format.replace('BO', '')}
                </div>
                <div className="text-2xl font-bold text-white">
                  {match.maps[match.currentMap - 1]?.name || 'TBD'}
                </div>
              </div>
              
              {/* é˜Ÿä¼B */}
              <TeamSection 
                team={match.teamB} 
                score={match.teamB.score}
                side="right"
              />
            </div>
          </div>
        </motion.div>
      )}
    </AnimatePresence>
  );
}

function TeamSection({ team, score, side }: any) {
  return (
    <motion.div 
      className={`flex items-center gap-4 ${side === 'right' ? 'flex-row-reverse' : ''}`}
      key={score} // Keyå˜åŒ–è§¦å‘åŠ¨ç”»
      initial={{ scale: 1 }}
      animate={{ scale: [1, 1.1, 1] }}
      transition={{ duration: 0.3 }}
    >
      <img 
        src={team.logo} 
        alt={team.name}
        className="w-12 h-12 object-contain"
      />
      <div className={side === 'right' ? 'text-right' : ''}>
        <div className="text-xl font-bold text-white">
          {team.shortName}
        </div>
        <div className="text-sm text-gray-400">
          {team.name}
        </div>
      </div>
      <div className="text-4xl font-bold text-white min-w-[60px] text-center">
        {score}
      </div>
    </motion.div>
  );
}
```

#### BPç³»ç»Ÿç»„ä»¶

```typescript
// components/overlays/BP.tsx
'use client';

import { useEffect, useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { socketService } from '@/lib/socket';
import { BPSession, BPAction } from '@/types';

const MAP_POOL = [
  { name: 'Dust2', image: '/maps/dust2.jpg' },
  { name: 'Mirage', image: '/maps/mirage.jpg' },
  { name: 'Inferno', image: '/maps/inferno.jpg' },
  { name: 'Nuke', image: '/maps/nuke.jpg' },
  { name: 'Overpass', image: '/maps/overpass.jpg' },
  { name: 'Vertigo', image: '/maps/vertigo.jpg' },
  { name: 'Ancient', image: '/maps/ancient.jpg' },
];

export default function BP() {
  const [session, setSession] = useState<BPSession | null>(null);
  const [visible, setVisible] = useState(false);

  useEffect(() => {
    socketService.on('bp:update', (data: BPSession) => {
      setSession(data);
    });

    socketService.on('overlay:update', (data: any) => {
      if (data.name === 'bp') {
        setVisible(data.visible);
      }
    });

    return () => {
      socketService.off('bp:update');
      socketService.off('overlay:update');
    };
  }, []);

  if (!visible || !session) return null;

  const getMapStatus = (mapName: string) => {
    const action = session.actions.find(a => a.map === mapName);
    return action || null;
  };

  return (
    <motion.div
      className="fixed inset-0 flex items-center justify-center"
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
    >
      <div className="bg-gray-900/95 backdrop-blur-md rounded-2xl p-12 shadow-2xl">
        <h2 className="text-4xl font-bold text-white text-center mb-8">
          Map Veto
        </h2>
        
        <div className="grid grid-cols-4 gap-6">
          {MAP_POOL.map((map, index) => {
            const status = getMapStatus(map.name);
            return (
              <MapCard 
                key={map.name}
                map={map}
                status={status}
                index={index}
              />
            );
          })}
        </div>

        {/* å½“å‰æ“ä½œæç¤º */}
        <motion.div 
          className="mt-8 text-center"
          key={session.activeTeam + session.currentPhase}
          initial={{ y: 20, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
        >
          <div className="text-2xl text-white">
            Team {session.activeTeam} - {session.currentPhase.toUpperCase()}
          </div>
          {session.countdown > 0 && (
            <div className="text-5xl font-bold text-orange-500 mt-2">
              {session.countdown}s
            </div>
          )}
        </motion.div>
      </div>
    </motion.div>
  );
}

function MapCard({ map, status, index }: any) {
  const isBanned = status?.type === 'ban';
  const isPicked = status?.type === 'pick';

  return (
    <motion.div
      className="relative overflow-hidden rounded-lg aspect-video"
      initial={{ opacity: 0, y: 50 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ delay: index * 0.1 }}
    >
      <img 
        src={map.image} 
        alt={map.name}
        className={`w-full h-full object-cover transition-all ${
          isBanned ? 'grayscale brightness-50' : ''
        }`}
      />
      
      {/* åœ°å›¾åç§° */}
      <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 to-transparent p-4">
        <div className="text-xl font-bold text-white">
          {map.name}
        </div>
      </div>

      {/* Ban/Pickæ ‡è®° */}
      <AnimatePresence>
        {status && (
          <motion.div
            className={`absolute inset-0 flex items-center justify-center ${
              isBanned ? 'bg-red-500/80' : 'bg-green-500/80'
            }`}
            initial={{ scale: 0 }}
            animate={{ scale: 1 }}
            exit={{ scale: 0 }}
          >
            <div className="text-6xl font-bold text-white">
              {isBanned ? 'BANNED' : 'PICKED'}
            </div>
            <div className="absolute bottom-4 text-2xl text-white">
              Team {status.team}
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </motion.div>
  );
}
```

### 3. æ§åˆ¶é¢æ¿å®ç°

#### æ¯”èµ›æ§åˆ¶ç»„ä»¶

```typescript
// app/admin/match-control/page.tsx
'use client';

import { useState } from 'react';
import { socketService } from '@/lib/socket';
import { Match } from '@/types';

export default function MatchControl() {
  const [match, setMatch] = useState<Match | null>(null);

  const updateScore = (team: 'A' | 'B', delta: number) => {
    socketService.emit('match:scoreUpdate', { team, delta });
  };

  const resetMatch = () => {
    if (confirm('ç¡®å®šè¦é‡ç½®æ¯”èµ›å—ï¼Ÿ')) {
      socketService.emit('match:reset', { matchId: match?.id });
    }
  };

  return (
    <div className="p-8">
      <h1 className="text-3xl font-bold mb-8">æ¯”èµ›æ§åˆ¶</h1>
      
      {/* æ¯”åˆ†æ§åˆ¶ */}
      <div className="grid grid-cols-2 gap-8 mb-8">
        <ScoreControl 
          team={match?.teamA}
          side="A"
          onUpdate={updateScore}
        />
        <ScoreControl 
          team={match?.teamB}
          side="B"
          onUpdate={updateScore}
        />
      </div>

      {/* åœ°å›¾æ§åˆ¶ */}
      <div className="bg-white rounded-lg p-6 shadow mb-8">
        <h2 className="text-xl font-bold mb-4">åœ°å›¾æ§åˆ¶</h2>
        <div className="grid grid-cols-7 gap-4">
          {MAP_POOL.map(map => (
            <button
              key={map.name}
              onClick={() => selectMap(map.name)}
              className="p-4 border rounded hover:bg-gray-50"
            >
              <img src={map.image} className="w-full mb-2" />
              <div className="text-sm">{map.name}</div>
            </button>
          ))}
        </div>
      </div>

      {/* å¿«æ·æ“ä½œ */}
      <div className="flex gap-4">
        <button
          onClick={resetMatch}
          className="px-6 py-3 bg-red-500 text-white rounded hover:bg-red-600"
        >
          é‡ç½®æ¯”èµ›
        </button>
        <button
          onClick={() => socketService.emit('match:pause')}
          className="px-6 py-3 bg-yellow-500 text-white rounded hover:bg-yellow-600"
        >
          æš‚åœ
        </button>
      </div>
    </div>
  );
}

function ScoreControl({ team, side, onUpdate }: any) {
  return (
    <div className="bg-white rounded-lg p-6 shadow">
      <div className="flex items-center gap-4 mb-4">
        <img src={team?.logo} className="w-16 h-16" />
        <div>
          <div className="text-2xl font-bold">{team?.name}</div>
          <div className="text-gray-500">{team?.shortName}</div>
        </div>
      </div>
      
      <div className="flex items-center gap-4">
        <button
          onClick={() => onUpdate(side, -1)}
          className="px-6 py-3 bg-red-500 text-white rounded text-2xl font-bold hover:bg-red-600"
        >
          -1
        </button>
        
        <div className="text-6xl font-bold flex-1 text-center">
          {team?.score || 0}
        </div>
        
        <button
          onClick={() => onUpdate(side, 1)}
          className="px-6 py-3 bg-green-500 text-white rounded text-2xl font-bold hover:bg-green-600"
        >
          +1
        </button>
      </div>
    </div>
  );
}
```

### 4. æ•°æ®æŒä¹…åŒ–

#### Prisma Schema

```prisma
// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Event {
  id        String   @id @default(cuid())
  name      String
  logo      String?
  startDate DateTime
  endDate   DateTime
  format    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  matches   Match[]
  sponsors  Sponsor[]
}

model Team {
  id         String   @id @default(cuid())
  name       String
  shortName  String
  logo       String?
  country    String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  players    Player[]
  matchesA   Match[]  @relation("TeamA")
  matchesB   Match[]  @relation("TeamB")
}

model Player {
  id        String   @id @default(cuid())
  gameId    String   @unique
  realName  String
  country   String
  avatar    String?
  teamId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  team      Team     @relation(fields: [teamId], references: [id])
}

model Match {
  id          String      @id @default(cuid())
  eventId     String
  teamAId     String
  teamBId     String
  format      String
  currentMap  Int         @default(1)
  status      String      @default("upcoming")
  startTime   DateTime
  endTime     DateTime?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  event       Event       @relation(fields: [eventId], references: [id])
  teamA       Team        @relation("TeamA", fields: [teamAId], references: [id])
  teamB       Team        @relation("TeamB", fields: [teamBId], references: [id])
  maps        Map[]
  bpSessions  BPSession[]
}

model Map {
  id        String   @id @default(cuid())
  matchId   String
  name      String
  order     Int
  scoreA    Int      @default(0)
  scoreB    Int      @default(0)
  status    String   @default("upcoming")
  winner    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  match     Match    @relation(fields: [matchId], references: [id])
  rounds    Round[]
}

model Round {
  id          String   @id @default(cuid())
  mapId       String
  roundNumber Int
  winner      String
  reason      String
  mvp         String?
  createdAt   DateTime @default(now())
  
  map         Map      @relation(fields: [mapId], references: [id])
}

model BPSession {
  id           String     @id @default(cuid())
  matchId      String
  mapPool      String[]
  currentPhase String     @default("ban")
  activeTeam   String     @default("A")
  countdown    Int        @default(0)
  status       String     @default("active")
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  
  match        Match      @relation(fields: [matchId], references: [id])
  actions      BPAction[]
}

model BPAction {
  id        String   @id @default(cuid())
  sessionId String
  type      String
  team      String
  map       String
  order     Int
  createdAt DateTime @default(now())
  
  session   BPSession @relation(fields: [sessionId], references: [id])
}

model Sponsor {
  id              String  @id @default(cuid())
  eventId         String
  name            String
  logo            String
  tier            String
  displayDuration Int     @default(5)
  
  event           Event   @relation(fields: [eventId], references: [id])
}
```

### 5. é”™è¯¯å¤„ç†ä¸é™çº§æ–¹æ¡ˆ

#### æ–­çº¿é‡è¿

```typescript
// lib/reconnection.ts
import { socketService } from './socket';

class ReconnectionManager {
  private reconnectAttempts = 0;
  private maxAttempts = 5;
  private backupData: any = null;

  async handleDisconnection() {
    // ä¿å­˜å½“å‰çŠ¶æ€åˆ°æœ¬åœ°
    this.saveToLocalStorage();
    
    // å°è¯•é‡è¿
    while (this.reconnectAttempts < this.maxAttempts) {
      await this.sleep(this.getBackoffDelay());
      
      try {
        await socketService.connect(process.env.NEXT_PUBLIC_SOCKET_URL!);
        this.reconnectAttempts = 0;
        this.restoreFromLocalStorage();
        return true;
      } catch (error) {
        this.reconnectAttempts++;
      }
    }
    
    // è¿æ¥å¤±è´¥ï¼Œå¯ç”¨ç¦»çº¿æ¨¡å¼
    this.enableOfflineMode();
    return false;
  }

  private getBackoffDelay() {
    // æŒ‡æ•°é€€é¿ç®—æ³•
    return Math.min(1000 * Math.pow(2, this.reconnectAttempts), 30000);
  }

  private saveToLocalStorage() {
    const state = {
      match: store.getState().match,
      bp: store.getState().bp,
      timestamp: Date.now()
    };
    localStorage.setItem('backup-state', JSON.stringify(state));
  }

  private restoreFromLocalStorage() {
    const backup = localStorage.getItem('backup-state');
    if (backup) {
      const state = JSON.parse(backup);
      // æ£€æŸ¥æ•°æ®æ˜¯å¦è¿‡æœŸï¼ˆ5åˆ†é’Ÿï¼‰
      if (Date.now() - state.timestamp < 5 * 60 * 1000) {
        store.setState(state);
      }
    }
  }

  private enableOfflineMode() {
    // æ˜¾ç¤ºç¦»çº¿æç¤º
    toast.error('æœåŠ¡å™¨è¿æ¥å¤±è´¥ï¼Œå·²è¿›å…¥ç¦»çº¿æ¨¡å¼');
    
    // ç¦ç”¨å®æ—¶åŠŸèƒ½
    store.setState({ offlineMode: true });
  }

  private sleep(ms: number) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}

export const reconnectionManager = new ReconnectionManager();
```

#### æ•°æ®æ ¡éªŒ

```typescript
// lib/validation.ts
import { z } from 'zod';

// Matchæ•°æ®æ ¡éªŒ
export const MatchSchema = z.object({
  id: z.string(),
  teamA: z.object({
    id: z.string(),
    name: z.string(),
    score: z.number().min(0)
  }),
  teamB: z.object({
    id: z.string(),
    name: z.string(),
    score: z.number().min(0)
  }),
  format: z.enum(['BO1', 'BO3', 'BO5']),
  currentMap: z.number().min(1),
  status: z.enum(['upcoming', 'live', 'finished'])
});

// BPæ•°æ®æ ¡éªŒ
export const BPSessionSchema = z.object({
  id: z.string(),
  matchId: z.string(),
  mapPool: z.array(z.string()).length(7),
  actions: z.array(z.object({
    type: z.enum(['ban', 'pick']),
    team: z.enum(['A', 'B']),
    map: z.string()
  })),
  currentPhase: z.enum(['ban', 'pick']),
  activeTeam: z.enum(['A', 'B'])
});

// æ•°æ®æ ¡éªŒä¸­é—´ä»¶
export function validateData<T>(schema: z.ZodSchema<T>, data: any): T {
  try {
    return schema.parse(data);
  } catch (error) {
    console.error('Data validation failed:', error);
    throw new Error('Invalid data format');
  }
}
```

---

## éƒ¨ç½²æŒ‡å—

### Dockeréƒ¨ç½²

#### Dockerfile

```dockerfile
# Frontend Dockerfile
FROM node:18-alpine AS base

# Dependencies
FROM base AS deps
WORKDIR /app
COPY package.json package-lock.json ./
RUN npm ci

# Builder
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npm run build

# Runner
FROM base AS runner
WORKDIR /app
ENV NODE_ENV production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000
ENV PORT 3000

CMD ["node", "server.js"]
```

```dockerfile
# Backend Dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

EXPOSE 3001

CMD ["node", "dist/index.js"]
```

#### Docker Compose

```yaml
# docker-compose.yml
version: '3.8'

services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_SOCKET_URL=http://backend:3001
    depends_on:
      - backend
    networks:
      - app-network

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "3001:3001"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/cs2overlay
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    networks:
      - app-network

  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=cs2overlay
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - app-network

  redis:
    image: redis:7-alpine
    volumes:
      - redis-data:/data
    networks:
      - app-network

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl:/etc/nginx/ssl:ro
    depends_on:
      - frontend
      - backend
    networks:
      - app-network

networks:
  app-network:
    driver: bridge

volumes:
  postgres-data:
  redis-data:
```

### Nginxé…ç½®

```nginx
# nginx.conf
upstream frontend {
  server frontend:3000;
}

upstream backend {
  server backend:3001;
}

server {
  listen 80;
  server_name your-domain.com;
  return 301 https://$server_name$request_uri;
}

server {
  listen 443 ssl http2;
  server_name your-domain.com;

  ssl_certificate /etc/nginx/ssl/cert.pem;
  ssl_certificate_key /etc/nginx/ssl/key.pem;

  # Frontend
  location / {
    proxy_pass http://frontend;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;
  }

  # Backend API
  location /api {
    proxy_pass http://backend;
    proxy_http_version 1.1;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $host;
  }

  # WebSocket
  location /socket.io {
    proxy_pass http://backend;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }
}
```

### éƒ¨ç½²æ­¥éª¤

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/cs2-overlay.git
cd cs2-overlay

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘.envæ–‡ä»¶

# 3. æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d

# 4. æ£€æŸ¥çŠ¶æ€
docker-compose ps

# 5. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# 6. æ•°æ®åº“è¿ç§»
docker-compose exec backend npm run prisma:migrate

# 7. åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼ˆå¦‚æœ‰ï¼‰
docker-compose exec backend npm run seed
```

### æ€§èƒ½ä¼˜åŒ–

#### å‰ç«¯ä¼˜åŒ–

```typescript
// next.config.js
module.exports = {
  compress: true,
  images: {
    formats: ['image/webp'],
    deviceSizes: [640, 750, 828, 1080, 1200, 1920],
  },
  swcMinify: true,
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production',
  },
};
```

#### ç¼“å­˜ç­–ç•¥

```typescript
// ä½¿ç”¨React Queryç¼“å­˜
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿ
      cacheTime: 10 * 60 * 1000, // 10åˆ†é’Ÿ
      refetchOnWindowFocus: false,
    },
  },
});
```

---

## ä½¿ç”¨æ‰‹å†Œ

### OBSé…ç½®æŒ‡å—

#### 1. æ·»åŠ æµè§ˆå™¨æº

1. åœ¨OBSä¸­å³é”®ç‚¹å‡»åœºæ™¯
2. é€‰æ‹©"æ·»åŠ " â†’ "æµè§ˆå™¨"
3. é…ç½®å‚æ•°ï¼š
   - **URL**: `http://localhost:3000/overlay/scoreboard`
   - **å®½åº¦**: 1920
   - **é«˜åº¦**: 1080
   - **FPS**: 60
   - **å‹¾é€‰**: "å½“æºä¸å¯è§æ—¶å…³é—­æº"
   - **è‡ªå®šä¹‰CSS**: 
     ```css
     body { background-color: rgba(0, 0, 0, 0); margin: 0px auto; overflow: hidden; }
     ```

#### 2. æ¨èåœºæ™¯é…ç½®

**å¼€åœºåœºæ™¯**:
- æ¸¸æˆç”»é¢
- æ¯”åˆ†æ¿ (Scoreboard)
- é¡¶éƒ¨ä¿¡æ¯æ  (Top Bar)

**BPåœºæ™¯**:
- BPç•Œé¢ (BP)
- èƒŒæ™¯éŸ³ä¹

**æ¯”èµ›ä¸­åœºæ™¯**:
- æ¸¸æˆç”»é¢
- æ¯”åˆ†æ¿
- é€‰æ‰‹æ‘„åƒå¤´ + è¾¹æ¡†

**ä¸­åœºä¼‘æ¯**:
- ä¼‘æ¯ç”»é¢ (Break)
- èµåŠ©å•†å±•ç¤º

#### 3. å¿«æ·é”®è®¾ç½®

å»ºè®®è®¾ç½®ä»¥ä¸‹å¿«æ·é”®ï¼š
- F1: æ˜¾ç¤º/éšè—æ¯”åˆ†æ¿
- F2: æ˜¾ç¤º/éšè—BP
- F3: æ˜¾ç¤º/éšè—é€‰æ‰‹ä¿¡æ¯
- F4: åˆ‡æ¢åˆ°æ¯”èµ›åœºæ™¯
- F5: åˆ‡æ¢åˆ°ä¸­åœºåœºæ™¯

### æ§åˆ¶é¢æ¿ä½¿ç”¨

#### æ¯”èµ›å‰å‡†å¤‡

1. **åˆ›å»ºæ¯”èµ›**
   - è¿›å…¥ `/admin/dashboard`
   - ç‚¹å‡»"æ–°å»ºæ¯”èµ›"
   - å¡«å†™æ¯”èµ›ä¿¡æ¯ï¼ˆé˜Ÿä¼ã€èµ›åˆ¶ç­‰ï¼‰
   - ä¿å­˜

2. **é…ç½®é˜Ÿä¼ä¿¡æ¯**
   - ä¸Šä¼ é˜Ÿä¼Logo
   - è®¾ç½®é˜Ÿåå’Œç¼©å†™
   - æ·»åŠ é€‰æ‰‹åå•

3. **è®¾ç½®BPæµç¨‹**
   - é€‰æ‹©èµ›åˆ¶ï¼ˆBO1/BO3/BO5ï¼‰
   - åŠ è½½å¯¹åº”BPæµç¨‹é¢„è®¾

#### æ¯”èµ›ä¸­æ“ä½œ

1. **æ§åˆ¶æ¯”åˆ†**
   - ä½¿ç”¨ +1/-1 æŒ‰é’®è°ƒæ•´æ¯”åˆ†
   - æˆ–ç›´æ¥è¾“å…¥åˆ†æ•°

2. **BPæ“ä½œ**
   - ç‚¹å‡»åœ°å›¾è¿›è¡ŒBan/Pick
   - ç³»ç»Ÿè‡ªåŠ¨åˆ‡æ¢é˜Ÿä¼å’Œé˜¶æ®µ
   - å¯æ’¤é”€ä¸Šä¸€æ­¥æ“ä½œ

3. **Overlayæ§åˆ¶**
   - ä½¿ç”¨å¼€å…³æ§åˆ¶æ˜¾ç¤º/éšè—
   - åˆ‡æ¢é¢„è®¾åœºæ™¯

### å¸¸è§é—®é¢˜

#### Q: Overlayä¸æ˜¾ç¤ºï¼Ÿ
A: æ£€æŸ¥ï¼š
1. URLæ˜¯å¦æ­£ç¡®
2. æœåŠ¡æ˜¯å¦è¿è¡Œ
3. WebSocketæ˜¯å¦è¿æ¥
4. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

#### Q: åŠ¨ç”»å¡é¡¿ï¼Ÿ
A: å°è¯•ï¼š
1. é™ä½OBSçš„FPSè®¾ç½®
2. å‡å°‘åŒæ—¶æ˜¾ç¤ºçš„overlayæ•°é‡
3. æ£€æŸ¥CPUå ç”¨

#### Q: WebSocketé¢‘ç¹æ–­å¼€ï¼Ÿ
A: æ£€æŸ¥ï¼š
1. ç½‘ç»œè¿æ¥
2. é˜²ç«å¢™è®¾ç½®
3. æœåŠ¡å™¨è´Ÿè½½
4. Nginxé…ç½®

#### Q: GSIæ•°æ®ä¸æ›´æ–°ï¼Ÿ
A: æ£€æŸ¥ï¼š
1. CS2æ¸¸æˆæ˜¯å¦è¿è¡Œ
2. GSIé…ç½®æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
3. Tokenæ˜¯å¦åŒ¹é…
4. åç«¯GSIæœåŠ¡å™¨ç«¯å£æ˜¯å¦å¼€å¯
5. é˜²ç«å¢™æ˜¯å¦é˜»æ­¢localhostè¿æ¥

#### Q: Electronåº”ç”¨æ— æ³•å¯åŠ¨ï¼Ÿ
A: å°è¯•ï¼š
1. åˆ é™¤node_modulesé‡æ–°å®‰è£…
2. æ£€æŸ¥æ˜¯å¦æœ‰ç«¯å£å†²çª
3. æŸ¥çœ‹Electronå¼€å‘è€…å·¥å…·æ§åˆ¶å°
4. æ£€æŸ¥ç³»ç»Ÿå…¼å®¹æ€§ï¼ˆéœ€è¦Windows 10+/macOS 10.13+ï¼‰

### GSIé…ç½®è¯¦ç»†æŒ‡å—

#### 1. æ‰¾åˆ°CS2é…ç½®ç›®å½•

**Windows**:
```
C:\Program Files (x86)\Steam\steamapps\common\Counter-Strike Global Offensive\game\csgo\cfg\
```

**macOS**:
```
~/Library/Application Support/Steam/steamapps/common/Counter-Strike Global Offensive/game/csgo/cfg/
```

**Linux**:
```
~/.steam/steam/steamapps/common/Counter-Strike Global Offensive/game/csgo/cfg/
```

#### 2. åˆ›å»ºé…ç½®æ–‡ä»¶

æ–‡ä»¶å: `gamestate_integration_overlay.cfg`

å®Œæ•´é…ç½®å†…å®¹:
```cfg
"CS2 Overlay Integration v1.0"
{
    "uri"               "http://localhost:3001/gsi"
    "timeout"           "5.0"
    "buffer"            "0.1"
    "throttle"          "0.5"
    "heartbeat"         "30.0"
    "auth"
    {
        "token"         "CS2_OVERLAY_SECRET_2024"
    }
    "data"
    {
        "provider"            "1"      // æ¸¸æˆä¿¡æ¯
        "map"                 "1"      // åœ°å›¾å’Œæ¯”åˆ†
        "round"               "1"      // å›åˆä¿¡æ¯
        "player_id"           "1"      // æœ¬åœ°ç©å®¶ID
        "player_state"        "1"      // ç©å®¶çŠ¶æ€
        "player_weapons"      "1"      // æ­¦å™¨ä¿¡æ¯
        "player_match_stats"  "1"      // æ¯”èµ›ç»Ÿè®¡
        "allplayers"          "1"      // æ‰€æœ‰ç©å®¶æ•°æ®
        "bomb"                "1"      // C4ä¿¡æ¯
        "phase_countdowns"    "1"      // å€’è®¡æ—¶
    }
}
```

#### 3. éªŒè¯GSIé…ç½®

å¯åŠ¨CS2åï¼Œåœ¨åç«¯æ—¥å¿—ä¸­åº”è¯¥çœ‹åˆ°ï¼š
```
[GSI] Received heartbeat from CS2
[GSI] Map: de_dust2, Round: 1, Phase: warmup
```

#### 4. æµ‹è¯•GSIè¿æ¥

ä½¿ç”¨curlæµ‹è¯•ï¼š
```bash
curl -X POST http://localhost:3001/gsi \
  -H "Content-Type: application/json" \
  -d '{"auth":{"token":"CS2_OVERLAY_SECRET_2024"},"map":{"name":"de_dust2"}}'
```

### Electronä½¿ç”¨æŒ‡å—

#### å¯åŠ¨æ¡Œé¢åº”ç”¨

**å¼€å‘æ¨¡å¼**:
```bash
cd packages/desktop
pnpm dev
```

**ç”Ÿäº§æ¨¡å¼**:
åŒå‡»å®‰è£…åçš„åº”ç”¨å›¾æ ‡

#### åŸºæœ¬æ“ä½œ

1. **ç³»ç»Ÿæ‰˜ç›˜**
   - åŒå‡»æ‰˜ç›˜å›¾æ ‡æ‰“å¼€æ§åˆ¶é¢æ¿
   - å³é”®æ‰˜ç›˜å›¾æ ‡æ˜¾ç¤ºèœå•
   - æœ€å°åŒ–æ—¶éšè—åˆ°æ‰˜ç›˜

2. **å…¨å±€å¿«æ·é”®**
   - `Ctrl+Shift+O`: æ‰“å¼€æ§åˆ¶é¢æ¿
   - `F1-F5`: åˆ‡æ¢Overlayåœºæ™¯
   - `Ctrl+Q`: é€€å‡ºåº”ç”¨

3. **è‡ªåŠ¨å¯åŠ¨**
   - è®¾ç½® â†’ å¼€æœºè‡ªåŠ¨å¯åŠ¨
   - Windows: æ·»åŠ åˆ°å¯åŠ¨é¡¹
   - macOS: ç™»å½•é¡¹è®¾ç½®

4. **æ›´æ–°æ£€æŸ¥**
   - å¸®åŠ© â†’ æ£€æŸ¥æ›´æ–°
   - æ”¯æŒè‡ªåŠ¨ä¸‹è½½å®‰è£…

#### æ‰“åŒ…åˆ†å‘

**Windows (.exe)**:
```bash
pnpm build:win
# è¾“å‡º: dist-electron/CS2-Overlay-Setup-1.0.0.exe
```

**macOS (.dmg)**:
```bash
pnpm build:mac
# è¾“å‡º: dist-electron/CS2-Overlay-1.0.0.dmg
```

**Linux (.AppImage)**:
```bash
pnpm build:linux
# è¾“å‡º: dist-electron/CS2-Overlay-1.0.0.AppImage
```

---

## é™„å½•

### A. æŠ€æœ¯æ ˆå®Œæ•´æ¸…å•

#### å‰ç«¯ä¾èµ– (packages/web)

```json
{
  "dependencies": {
    "next": "15.0.0",
    "react": "18.2.0",
    "react-dom": "18.2.0",
    "typescript": "5.2.0",
    "framer-motion": "11.0.0",
    "socket.io-client": "4.7.0",
    "zustand": "4.5.0",
    "@tanstack/react-query": "5.0.0",
    "tailwindcss": "3.4.0",
    "zod": "3.22.0",
    "date-fns": "3.0.0",
    "recharts": "2.10.0",
    "lucide-react": "0.300.0"
  },
  "devDependencies": {
    "@types/node": "20.10.0",
    "@types/react": "18.2.0",
    "eslint": "8.56.0",
    "prettier": "3.1.0"
  }
}
```

#### æ¡Œé¢åº”ç”¨ä¾èµ– (packages/desktop)

```json
{
  "dependencies": {
    "react": "18.2.0",
    "react-dom": "18.2.0",
    "socket.io-client": "4.7.0",
    "zustand": "4.5.0",
    "tailwindcss": "3.4.0"
  },
  "devDependencies": {
    "electron": "28.0.0",
    "electron-builder": "24.9.0",
    "vite": "5.0.0",
    "@vitejs/plugin-react": "4.2.0",
    "typescript": "5.2.0"
  }
}
```

#### åç«¯ä¾èµ– (packages/server)

```json
{
  "dependencies": {
    "express": "4.18.2",
    "socket.io": "4.7.0",
    "prisma": "5.8.0",
    "@prisma/client": "5.8.0",
    "cors": "2.8.5",
    "dotenv": "16.3.1",
    "zod": "3.22.0",
    "bcrypt": "5.1.1",
    "jsonwebtoken": "9.0.2",
    "helmet": "7.1.0",
    "rate-limiter-flexible": "3.0.0"
  },
  "devDependencies": {
    "@types/express": "4.17.21",
    "@types/cors": "2.8.17",
    "nodemon": "3.0.2",
    "ts-node": "10.9.2"
  }
}
```

#### å…±äº«åŒ…ä¾èµ– (packages/shared)

```json
{
  "dependencies": {
    "zod": "3.22.0"
  },
  "devDependencies": {
    "typescript": "5.2.0"
  }
}
```

#### Monorepoæ ¹ä¾èµ–

```json
{
  "devDependencies": {
    "turbo": "1.11.0",
    "typescript": "5.2.0",
    "prettier": "3.1.0",
    "eslint": "8.56.0"
  }
}
```

### B. Gitå·¥ä½œæµ

#### åˆ†æ”¯ç­–ç•¥

```
main          - ç”Ÿäº§ç¯å¢ƒ
  â””â”€ develop  - å¼€å‘ç¯å¢ƒ
      â”œâ”€ feature/scoreboard
      â”œâ”€ feature/bp-system
      â””â”€ feature/admin-panel
```

#### Commitè§„èŒƒ

```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼
refactor: é‡æ„
perf: æ€§èƒ½ä¼˜åŒ–
test: æµ‹è¯•
chore: æ„å»º/å·¥å…·

ä¾‹å¦‚ï¼š
feat(overlay): add scoreboard animation
fix(bp): resolve pick order issue
docs: update deployment guide
```

### C. æµ‹è¯•æ¸…å•

#### åŠŸèƒ½æµ‹è¯•

- [ ] æ¯”åˆ†æ¿æ˜¾ç¤ºæ­£ç¡®
- [ ] æ¯”åˆ†æ›´æ–°å®æ—¶åŒæ­¥
- [ ] BPæµç¨‹å®Œæ•´å¯ç”¨
- [ ] æ‰€æœ‰overlayå¯åˆ‡æ¢
- [ ] æ§åˆ¶é¢æ¿åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®æŒä¹…åŒ–æ­£å¸¸
- [ ] **GSIæ•°æ®å®æ—¶æ¥æ”¶**
- [ ] **GSIè‡ªåŠ¨æ¯”åˆ†æ›´æ–°**
- [ ] **Electronåº”ç”¨æ­£å¸¸å¯åŠ¨**
- [ ] **Electronæ‰˜ç›˜å›¾æ ‡åŠŸèƒ½**
- [ ] **Electronå¿«æ·é”®å“åº”**

#### æ€§èƒ½æµ‹è¯•

- [ ] Overlayæ¸²æŸ“60fps
- [ ] WebSocketå»¶è¿Ÿ<100ms
- [ ] å†…å­˜å ç”¨ç¨³å®š
- [ ] é•¿æ—¶é—´è¿è¡Œæ— æ³„æ¼
- [ ] **GSIæ•°æ®å¤„ç†å»¶è¿Ÿ<50ms**
- [ ] **Electronåº”ç”¨å†…å­˜å ç”¨<200MB**

#### å…¼å®¹æ€§æµ‹è¯•

- [ ] OBS 28+ å…¼å®¹
- [ ] Chrome/Edgeæµè§ˆå™¨
- [ ] 1920x1080åˆ†è¾¨ç‡
- [ ] Windows/Mac/Linux
- [ ] **CS2æœ€æ–°ç‰ˆæœ¬GSIå…¼å®¹**
- [ ] **Electronåœ¨Windows 10+è¿è¡Œ**
- [ ] **Electronåœ¨macOS 10.13+è¿è¡Œ**

### D. èµ„æºé“¾æ¥

**å®˜æ–¹æ–‡æ¡£**:
- **OBSå®˜ç½‘**: https://obsproject.com/
- **Socket.ioæ–‡æ¡£**: https://socket.io/docs/
- **Framer Motion**: https://www.framer.com/motion/
- **Next.jsæ–‡æ¡£**: https://nextjs.org/docs
- **Prismaæ–‡æ¡£**: https://www.prisma.io/docs
- **Electronæ–‡æ¡£**: https://www.electronjs.org/docs
- **Turborepoæ–‡æ¡£**: https://turbo.build/repo/docs
- **pnpmæ–‡æ¡£**: https://pnpm.io/

**CS2 GSI**:
- **GSIå®˜æ–¹æ–‡æ¡£**: https://developer.valvesoftware.com/wiki/Counter-Strike:_Global_Offensive_Game_State_Integration
- **ç¤¾åŒºGSIç¤ºä¾‹**: https://github.com/search?q=cs2+gsi

**Electronç›¸å…³**:
- **electron-builder**: https://www.electron.build/
- **Vite + Electron**: https://github.com/electron-vite/electron-vite-vue

**ç¤¾åŒºèµ„æº**:
- **CS2 Overlayç¤¾åŒº**: https://www.reddit.com/r/GlobalOffensive/
- **GSIè®¨è®º**: DiscordæœåŠ¡å™¨ï¼ˆå¯åˆ›å»ºï¼‰

### E. å›¢é˜Ÿåä½œ

#### è§’è‰²åˆ†å·¥

- **å‰ç«¯å¼€å‘**: Overlayç»„ä»¶ã€æ§åˆ¶é¢æ¿UI
- **åç«¯å¼€å‘**: APIã€WebSocketã€GSIé›†æˆ
- **æ¡Œé¢åº”ç”¨å¼€å‘**: Electronåº”ç”¨ã€æ‰“åŒ…å‘å¸ƒ
- **UI/UXè®¾è®¡**: ç•Œé¢è®¾è®¡ã€åŠ¨ç”»æ•ˆæœ
- **æµ‹è¯•**: åŠŸèƒ½æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€GSIæµ‹è¯•
- **è¿ç»´**: éƒ¨ç½²ã€ç›‘æ§ã€ç»´æŠ¤ã€æ›´æ–°åˆ†å‘

#### æ²Ÿé€šæ¸ é“

- **æ—¥ä¼š**: æ¯æ—¥åŒæ­¥è¿›åº¦ï¼ˆ15åˆ†é’Ÿï¼‰
- **å‘¨ä¼š**: å›é¡¾ä¸è§„åˆ’
- **æ–‡æ¡£**: Notion/é£ä¹¦åä½œ
- **ä»£ç **: GitHub PR Review
- **é—®é¢˜è¿½è¸ª**: GitHub Issues
- **å®æ—¶æ²Ÿé€š**: Discord/Slack

---

## ç»“è¯­

æœ¬æ–‡æ¡£æä¾›äº†CS2èµ›äº‹ç›´æ’­Overlayç³»ç»Ÿçš„å®Œæ•´å¼€å‘æŒ‡å—ï¼ŒåŒ…æ‹¬æœ€æ–°çš„GSIé›†æˆå’ŒElectronæ¡Œé¢åº”ç”¨å¼€å‘ã€‚

**æ ¸å¿ƒä¼˜åŠ¿**:
1. âœ… **GSIè‡ªåŠ¨åŒ–** - å‘Šåˆ«æ‰‹åŠ¨è¾“å…¥ï¼Œå®æ—¶å‡†ç¡®
2. âœ… **Electronæ¡Œé¢åº”ç”¨** - ä¸“ä¸šå¯¼æ’­å·¥å…·ä½“éªŒ
3. âœ… **Monorepoæ¶æ„** - ä»£ç ç»„ç»‡æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
4. âœ… **å®Œæ•´å·¥ä½œæµ** - ä»å¼€å‘åˆ°æ‰“åŒ…åˆ†å‘

**å¼€å‘å»ºè®®**:
1. ä¿æŒä»£ç æ•´æ´å’Œæ–‡æ¡£æ›´æ–°
2. ä¼˜å…ˆå®ç°GSIé›†æˆï¼ˆWeek 3.5ï¼‰ï¼Œè¿™æ˜¯å¯¼æ’­ç³»ç»Ÿçš„æ ¸å¿ƒ
3. æ³¨é‡Electronåº”ç”¨çš„ç”¨æˆ·ä½“éªŒ
4. åšå¥½é”™è¯¯å¤„ç†å’Œé™çº§æ–¹æ¡ˆï¼ˆGSIæ–­å¼€æ—¶æ‰‹åŠ¨è¾“å…¥ï¼‰
5. åŠæ—¶æµ‹è¯•GSIåœ¨ä¸åŒCS2ç‰ˆæœ¬çš„å…¼å®¹æ€§

**é‡è¦æé†’**:
- GSIæ˜¯å®˜æ–¹APIï¼Œå®‰å…¨å¯é 
- Electronæ‰“åŒ…éœ€è¦ç­¾åè¯ä¹¦ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- Monorepoéœ€è¦åˆç†è§„åˆ’å…±äº«ä»£ç 
- å®šæœŸå¤‡ä»½é…ç½®å’Œæ•°æ®

ç¥å¼€å‘é¡ºåˆ©ï¼ğŸš€

**ç‰¹åˆ«æ„Ÿè°¢**:
- Valve Software - CS2 GSI API
- Electronå›¢é˜Ÿ - ä¼˜ç§€çš„æ¡Œé¢æ¡†æ¶
- ç¤¾åŒºè´¡çŒ®è€… - å¼€æºç²¾ç¥

---

**ç‰ˆæœ¬**: v2.0 (Updated with GSI & Electron)
**æœ€åæ›´æ–°**: 2025-01-30
**è®¸å¯**: MIT License